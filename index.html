<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>impactOS Saving Estimator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { overflow-x: hidden; }
        
        :root {
            --primary: #90d4f6; --primary-hover: #7cc3f0; --success: #22c55e; --warning: #FF9F0A;
            --neutral-50: #FAFAFA; --neutral-100: #F2F2F7; --neutral-200: #E5E5EA; --neutral-300: #D1D1D6;
            --neutral-600: #8E8E93; --neutral-700: #6D6D70; --neutral-800: #48484A; --neutral-900: #1C1C1E;
            --white: #FFFFFF;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            background: #f5f5f7;
            color: var(--neutral-800); -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        
        .calculator {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: var(--white);
            border-radius: 16px 16px 0 0;
            border-bottom: 1px solid var(--neutral-200);
        }
        
        .title {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--neutral-900);
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 1rem;
            color: var(--neutral-600);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: var(--white);
            border-bottom: 2px solid var(--neutral-200);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 16px 12px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            position: relative;
            font-family: inherit;
        }
        
        .tab:hover {
            background: var(--neutral-50);
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            background: rgba(144, 212, 246, 0.05);
        }
        
        .tab.green.active {
            border-bottom-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
        }
        
        .tab.completed {
            opacity: 1;
        }
        
        .tab.completed .tab-number {
            background: var(--success);
        }
        
        .tab-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--neutral-300);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .tab.active .tab-number,
        .tab.green.active .tab-number {
            background: var(--primary);
        }
        
        .tab.green .tab-number {
            background: var(--success);
        }
        
        .tab span:last-child {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--neutral-700);
            text-align: center;
        }
        
        .tab.active span:last-child {
            color: var(--neutral-900);
        }
        
        /* Tab Panels */
        .tab-panel {
            display: none;
            background: var(--white);
            padding: 40px;
            border-radius: 0 0 16px 16px;
            min-height: 500px;
        }
        
        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .panel-header {
            margin-bottom: 32px;
        }
        
        .panel-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--neutral-900);
            margin-bottom: 8px;
        }
        
        .panel-description {
            font-size: 1rem;
            color: var(--neutral-600);
            line-height: 1.6;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }
        
        .label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--neutral-900);
            font-size: 0.95rem;
        }
        
        .input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--neutral-200);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--white);
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(144, 212, 246, 0.1);
        }
        
        .input:hover {
            border-color: var(--neutral-300);
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        /* Usage Display */
        .usage-display {
            background: linear-gradient(135deg, #e3f2fd, #f5f5f5);
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            border: 2px solid var(--primary);
        }
        
        .usage-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .usage-label {
            color: var(--neutral-600);
            margin-top: 4px;
            font-size: 0.95rem;
        }
        
        /* Improved Sliders */
        .slider-section {
            margin-top: 24px;
        }
        
        .slider-intro {
            background: var(--neutral-50);
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .slider-intro strong {
            display: block;
            margin-bottom: 4px;
            color: var(--neutral-900);
        }
        
        .slider-intro p {
            font-size: 0.9rem;
            color: var(--neutral-600);
            line-height: 1.5;
        }
        
        .slider-item {
            margin-bottom: 28px;
            padding: 20px;
            background: var(--neutral-50);
            border-radius: 12px;
            border: 2px solid var(--neutral-200);
            transition: all 0.2s;
        }
        
        .slider-item:hover {
            border-color: var(--primary);
            background: rgba(144, 212, 246, 0.03);
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .slider-label {
            font-weight: 600;
            color: var(--neutral-900);
            font-size: 1rem;
        }
        
        .slider-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            min-width: 60px;
            text-align: right;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--neutral-200);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
            margin-bottom: 8px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
        
        .cups-display {
            font-size: 0.85rem;
            color: var(--neutral-600);
            text-align: right;
        }
        
        .validation {
            margin-top: 20px;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
        }
        
        .validation.valid {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
            border: 2px solid rgba(34, 197, 94, 0.3);
        }
        
        .validation.invalid {
            background: rgba(255, 107, 107, 0.1);
            color: #dc2626;
            border: 2px solid rgba(255, 107, 107, 0.3);
        }
        
        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 1px solid var(--neutral-200);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(144, 212, 246, 0.3);
        }
        
        .btn-secondary {
            background: var(--neutral-200);
            color: var(--neutral-700);
        }
        
        .btn-secondary:hover {
            background: var(--neutral-300);
        }
        
        .btn-success {
            background: var(--success);
            color: var(--white);
        }
        
        .btn-success:hover {
            background: #16a34a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        
        /* Results */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }
        
        .result-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            color: var(--white);
            box-shadow: 0 4px 12px rgba(144, 212, 246, 0.3);
        }
        
        .result-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .result-label {
            font-size: 0.95rem;
            opacity: 0.95;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .breakdown-toggle {
            margin-top: 24px;
            padding: 16px;
            background: var(--neutral-50);
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid var(--neutral-200);
            transition: all 0.2s;
        }
        
        .breakdown-toggle:hover {
            border-color: var(--primary);
        }
        
        .breakdown-content {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: var(--white);
            border-radius: 8px;
        }
        
        .breakdown-content.show {
            display: block;
        }
        
        /* Assumptions Modal */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .modal-backdrop.open {
            display: block;
        }
        
        .assumptions-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--white);
            padding: 32px;
            border-radius: 16px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .assumptions-modal.open {
            display: block;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }
        
        .close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: var(--neutral-200);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .assumption-group {
            margin-bottom: 24px;
        }
        
        .assumption-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--neutral-900);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .calculator {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .title {
                font-size: 1.8rem;
            }
            
            .tab-panel {
                padding: 20px;
            }
            
            .panel-title {
                font-size: 1.5rem;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .tab {
                min-width: 90px;
                padding: 12px 8px;
            }
            
            .tab span:last-child {
                font-size: 0.75rem;
            }
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="header">
            <h1 class="title">Calculate your savings</h1>
            <p class="subtitle">See the annual impact of switching to instarinse¬Æ</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab(1)">
                <span class="tab-number">1</span>
                <span>Your Site</span>
            </button>
            <button class="tab" onclick="showTab(2)">
                <span class="tab-number">2</span>
                <span>Current Mix</span>
            </button>
            <button class="tab" onclick="showTab(3)">
                <span class="tab-number">3</span>
                <span>With instarinse¬Æ</span>
            </button>
            <button class="tab" onclick="showTab(4)">
                <span class="tab-number">4</span>
                <span>Fine-tune</span>
            </button>
            <button class="tab green" onclick="showTab(5)">
                <span class="tab-number">5</span>
                <span>Your Impact</span>
            </button>
        </div>
        
        <!-- Tab 1: Your Site -->
        <div class="tab-panel active" id="panel-1">
            <div class="panel-header">
                <h2 class="panel-title">Tell us about your site</h2>
                <p class="panel-description">Enter basic information about your facility to calculate cup usage</p>
            </div>
            
            <div class="input-grid">
                <div class="form-group">
                    <label class="label" for="teamSize">Site Users</label>
                    <input type="number" id="teamSize" class="input" value="1500" min="10" max="50000">
                </div>
                
                <div class="form-group">
                    <label class="label" for="officeDays">Operating Days/Week</label>
                    <input type="number" id="officeDays" class="input" value="4" min="1" max="7">
                </div>
                
                <div class="form-group">
                    <label class="label" for="cupsPerDay">Cups per Person/Day</label>
                    <input type="number" id="cupsPerDay" class="input" value="2" min="1" max="10" step="0.5">
                </div>
            </div>
            
            <div class="usage-display">
                <div class="usage-number" id="dailyUsage">1,200</div>
                <div class="usage-label">Average daily cup usage</div>
            </div>
            
            <div class="nav-buttons">
                <div></div>
                <button class="btn btn-primary" onclick="showTab(2)">Next: Current Mix ‚Üí</button>
            </div>
        </div>
        
        <!-- Tab 2: Current Mix -->
        <div class="tab-panel" id="panel-2">
            <div class="panel-header">
                <h2 class="panel-title">How you serve and clean today</h2>
                <p class="panel-description">Adjust the sliders to show what percentage of cups use each method</p>
            </div>
            
            <div class="slider-intro">
                <strong>üìä Set your current mix</strong>
                <p>Move the sliders to reflect how you currently serve and clean cups. The percentages must add up to 100%.</p>
            </div>
            
            <div class="slider-section">
                <div class="slider-item">
                    <div class="slider-header">
                        <span class="slider-label">Paper Cups</span>
                        <span class="slider-value" id="currentPaperValue">30%</span>
                    </div>
                    <input type="range" class="slider" id="currentPaper" min="0" max="100" value="30" step="5">
                    <div class="cups-display" id="currentPaperCups">360 cups/day</div>
                </div>
                
                <div class="slider-item">
                    <div class="slider-header">
                        <span class="slider-label">Hand Washing</span>
                        <span class="slider-value" id="currentHandwashValue">20%</span>
                    </div>
                    <input type="range" class="slider" id="currentHandwash" min="0" max="100" value="20" step="5">
                    <div class="cups-display" id="currentHandwashCups">240 cups/day</div>
                </div>
                
                <div class="slider-item">
                    <div class="slider-header">
                        <span class="slider-label">Dishwasher</span>
                        <span class="slider-value" id="currentDishwasherValue">50%</span>
                    </div>
                    <input type="range" class="slider" id="currentDishwasher" min="0" max="100" value="50" step="5">
                    <div class="cups-display" id="currentDishwasherCups">600 cups/day</div>
                </div>
            </div>
            
            <div class="validation invalid" id="currentValidation">Total: 100% ‚úì</div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="showTab(1)">‚Üê Previous</button>
                <button class="btn btn-primary" onclick="showTab(3)">Next: With instarinse¬Æ ‚Üí</button>
            </div>
        </div>
        
        <!-- Tab 3: With instarinse¬Æ -->
        <div class="tab-panel" id="panel-3">
            <div class="panel-header">
                <h2 class="panel-title">With instarinse¬Æ</h2>
                <p class="panel-description">Adjust to show your optimized workflow with instarinse¬Æ</p>
            </div>
            
            <div class="slider-intro">
                <strong>‚ú® Plan your optimal mix</strong>
                <p>Set how you'd distribute cup cleaning with instarinse¬Æ in your workflow. The percentages must add up to 100%.</p>
            </div>
            
            <div class="slider-section">
                <div class="slider-item">
                    <div class="slider-header">
                        <span class="slider-label">Paper Cups</span>
                        <span class="slider-value" id="optimalPaperValue">0%</span>
                    </div>
                    <input type="range" class="slider" id="optimalPaper" min="0" max="100" value="0" step="5">
                    <div class="cups-display" id="optimalPaperCups">0 cups/day</div>
                </div>
                
                <div class="slider-item">
                    <div class="slider-header">
                        <span class="slider-label">instarinse¬Æ</span>
                        <span class="slider-value" id="optimalInstarinseValue">70%</span>
                    </div>
                    <input type="range" class="slider" id="optimalInstarinse" min="0" max="100" value="70" step="5">
                    <div class="cups-display" id="optimalInstarinseCups">840 cups/day</div>
                </div>
                
                <div class="slider-item">
                    <div class="slider-header">
                        <span class="slider-label">Hand Washing</span>
                        <span class="slider-value" id="optimalHandwashValue">10%</span>
                    </div>
                    <input type="range" class="slider" id="optimalHandwash" min="0" max="100" value="10" step="5">
                    <div class="cups-display" id="optimalHandwashCups">120 cups/day</div>
                </div>
                
                <div class="slider-item">
                    <div class="slider-header">
                        <span class="slider-label">Dishwasher</span>
                        <span class="slider-value" id="optimalDishwasherValue">20%</span>
                    </div>
                    <input type="range" class="slider" id="optimalDishwasher" min="0" max="100" value="20" step="5">
                    <div class="cups-display" id="optimalDishwasherCups">240 cups/day</div>
                </div>
            </div>
            
            <div class="validation valid" id="optimalValidation">Total: 100% ‚úì</div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="showTab(2)">‚Üê Previous</button>
                <button class="btn btn-primary" onclick="showTab(4)">Next: Fine-tune ‚Üí</button>
            </div>
        </div>
        
        <!-- Tab 4: Fine-tune Assumptions -->
        <div class="tab-panel" id="panel-4">
            <div class="panel-header">
                <h2 class="panel-title">Fine-tune Assumptions</h2>
                <p class="panel-description">Adjust costs and assumptions to match your specific situation (optional)</p>
            </div>
            
            <div class="slider-intro">
                <strong>‚öôÔ∏è Customize your calculations</strong>
                <p>These default values work for most sites, but you can adjust them to match your specific costs and usage patterns.</p>
            </div>
            
            <button class="btn btn-primary" onclick="openAssumptions()" style="width: 100%;">
                Open Advanced Settings
            </button>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="showTab(3)">‚Üê Previous</button>
                <button class="btn btn-success" onclick="showTab(5)">View Your Impact ‚Üí</button>
            </div>
        </div>
        
        <!-- Tab 5: Results -->
        <div class="tab-panel" id="panel-5">
            <div class="panel-header">
                <h2 class="panel-title">Your Annual Impact</h2>
                <p class="panel-description">See the cost savings and environmental benefits of switching to instarinse¬Æ</p>
            </div>
            
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-value" id="costSavings">¬£0</div>
                    <div class="result-label">Cost Savings</div>
                </div>
                
                <div class="result-card">
                    <div class="result-value" id="waterSaved">0L</div>
                    <div class="result-label">Water Conserved</div>
                </div>
                
                <div class="result-card">
                    <div class="result-value" id="co2Saved">0kg</div>
                    <div class="result-label">CO‚ÇÇ Eliminated</div>
                </div>
                
                <div class="result-card">
                    <div class="result-value" id="timeSaved">0 kWh</div>
                    <div class="result-label">Energy Saved</div>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="showTab(4)">‚Üê Previous</button>
                <button class="btn btn-success" onclick="exportToExcel()">Download Report</button>
            </div>
        </div>
    </div>
    
    <!-- Assumptions Modal -->
    <div class="modal-backdrop" id="modalBackdrop" onclick="closeAssumptions()"></div>
    <div class="assumptions-modal" id="assumptionsModal">
        <button class="close-btn" onclick="closeAssumptions()">√ó</button>
        <h2 class="modal-title">Advanced Settings</h2>
        
        <div class="assumption-group">
            <label class="assumption-label">Electricity Rate (¬£/kWh)</label>
            <input type="number" class="input" id="electricityRate" value="0.25" step="0.01">
        </div>
        
        <div class="assumption-group">
            <label class="assumption-label">Labour Rate (¬£/hour)</label>
            <input type="number" class="input" id="labourRate" value="12.21" step="0.01">
        </div>
        
        <h3 style="margin: 24px 0 16px;">Paper Cup Settings</h3>
        <div class="assumption-group">
            <label class="assumption-label">Cost per Cup (¬£)</label>
            <input type="number" class="input" id="paperCupCost" value="0.15" step="0.01">
        </div>
        
        <h3 style="margin: 24px 0 16px;">Dishwasher Settings</h3>
        <div class="assumption-group">
            <label class="assumption-label">Capacity (cups per load)</label>
            <input type="number" class="input" id="dishwasherCapacity" value="40" step="1">
        </div>
        
        <div class="assumption-group">
            <label class="assumption-label">Water per Load (L)</label>
            <input type="number" class="input" id="dishwasherWater" value="13.2" step="0.1">
        </div>
        
        <button class="btn btn-primary" onclick="updateCalculations(); closeAssumptions();" style="width: 100%; margin-top: 20px;">
            Save Changes
        </button>
    </div>

    <script>
        // Constants
        const DEFAULT_ASSUMPTIONS = {
            electricityRate: 0.25,
            labourRate: 12.21,
            paperCup: { cost: 0.15, water: 0.25, energy: 0.06, co2: 0.01 },
            handwash: { waterPerCup: 1.0, energyPerCup: 0.08, co2PerCup: 0.02, detergentPerCup: 0.01 },
            dishwasher: { capacity: 40, waterPerLoad: 13.2, energyPerLoad: 0.9, co2PerLoad: 0.16, labourTimePerLoad: 10, detergentPerLoad: 0.15 }
        };

        const GLOBAL_ASSUMPTIONS = JSON.parse(JSON.stringify(DEFAULT_ASSUMPTIONS));
        
        const INSTARINSE_CONSTANTS = {
            waterPerCup: 0.05,
            energyPerCup: 0.01,
            co2PerCup: 0.00,
            labourTimePerCup: 0.05 / 60
        };

        const state = {
            teamSize: 1500,
            officeDays: 4,
            cupsPerDay: 2,
            current: { paper: 30, handwash: 20, dishwasher: 50 },
            optimal: { paper: 0, instarinse: 70, handwash: 10, dishwasher: 20 }
        };

        const els = {
            teamSize: document.getElementById('teamSize'),
            officeDays: document.getElementById('officeDays'),
            cupsPerDay: document.getElementById('cupsPerDay'),
            dailyUsage: document.getElementById('dailyUsage'),
            
            currentPaper: document.getElementById('currentPaper'),
            currentHandwash: document.getElementById('currentHandwash'),
            currentDishwasher: document.getElementById('currentDishwasher'),
            currentPaperValue: document.getElementById('currentPaperValue'),
            currentHandwashValue: document.getElementById('currentHandwashValue'),
            currentDishwasherValue: document.getElementById('currentDishwasherValue'),
            currentPaperCups: document.getElementById('currentPaperCups'),
            currentHandwashCups: document.getElementById('currentHandwashCups'),
            currentDishwasherCups: document.getElementById('currentDishwasherCups'),
            currentValidation: document.getElementById('currentValidation'),
            
            optimalPaper: document.getElementById('optimalPaper'),
            optimalInstarinse: document.getElementById('optimalInstarinse'),
            optimalHandwash: document.getElementById('optimalHandwash'),
            optimalDishwasher: document.getElementById('optimalDishwasher'),
            optimalPaperValue: document.getElementById('optimalPaperValue'),
            optimalInstarinseValue: document.getElementById('optimalInstarinseValue'),
            optimalHandwashValue: document.getElementById('optimalHandwashValue'),
            optimalDishwasherValue: document.getElementById('optimalDishwasherValue'),
            optimalPaperCups: document.getElementById('optimalPaperCups'),
            optimalInstarinseCups: document.getElementById('optimalInstarinseCups'),
            optimalHandwashCups: document.getElementById('optimalHandwashCups'),
            optimalDishwasherCups: document.getElementById('optimalDishwasherCups'),
            optimalValidation: document.getElementById('optimalValidation'),
            
            costSavings: document.getElementById('costSavings'),
            waterSaved: document.getElementById('waterSaved'),
            co2Saved: document.getElementById('co2Saved'),
            timeSaved: document.getElementById('timeSaved')
        };

        // Tab Navigation
        function showTab(tabNumber) {
            const tabs = document.querySelectorAll('.tab');
            const panels = document.querySelectorAll('.tab-panel');
            
            tabs.forEach((tab, index) => {
                if (index + 1 === tabNumber) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
                
                // Mark tabs as completed if we've passed them
                if (index + 1 < tabNumber) {
                    tab.classList.add('completed');
                }
            });
            
            panels.forEach((panel, index) => {
                if (index + 1 === tabNumber) {
                    panel.classList.add('active');
                } else {
                    panel.classList.remove('active');
                }
            });
            
            // Calculate results when showing tab 5
            if (tabNumber === 5) {
                calculateSavings();
            }
        }

        // Formatting
        function formatNumber(num, decimals = 0) {
            return new Intl.NumberFormat('en-GB', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }

        function formatCurrency(amount) {
            return '¬£' + formatNumber(amount, 0);
        }

        // Daily Usage Calculation
        function updateDailyUsage() {
            const daily = (state.teamSize * state.cupsPerDay * state.officeDays) / 5;
            els.dailyUsage.textContent = formatNumber(daily);
            
            updateSliderDisplay('current');
            updateSliderDisplay('optimal');
            calculateSavings();
        }

        // Slider Display Updates
        function updateSliderDisplay(type) {
            const mix = state[type];
            const total = Object.values(mix).reduce((sum, val) => sum + val, 0);
            const dailyCups = (state.teamSize * state.cupsPerDay * state.officeDays) / 5;
            
            if (type === 'current') {
                els.currentPaperValue.textContent = mix.paper + '%';
                els.currentHandwashValue.textContent = mix.handwash + '%';
                els.currentDishwasherValue.textContent = mix.dishwasher + '%';
                
                els.currentPaperCups.textContent = formatNumber((mix.paper / 100) * dailyCups, 0) + ' cups/day';
                els.currentHandwashCups.textContent = formatNumber((mix.handwash / 100) * dailyCups, 0) + ' cups/day';
                els.currentDishwasherCups.textContent = formatNumber((mix.dishwasher / 100) * dailyCups, 0) + ' cups/day';
                
                els.currentValidation.textContent = total === 100 ? 'Total: 100% ‚úì' : `Total: ${total}% - adjust to 100%`;
                els.currentValidation.className = total === 100 ? 'validation valid' : 'validation invalid';
            } else {
                els.optimalPaperValue.textContent = mix.paper + '%';
                els.optimalInstarinseValue.textContent = mix.instarinse + '%';
                els.optimalHandwashValue.textContent = mix.handwash + '%';
                els.optimalDishwasherValue.textContent = mix.dishwasher + '%';
                
                els.optimalPaperCups.textContent = formatNumber((mix.paper / 100) * dailyCups, 0) + ' cups/day';
                els.optimalInstarinseCups.textContent = formatNumber((mix.instarinse / 100) * dailyCups, 0) + ' cups/day';
                els.optimalHandwashCups.textContent = formatNumber((mix.handwash / 100) * dailyCups, 0) + ' cups/day';
                els.optimalDishwasherCups.textContent = formatNumber((mix.dishwasher / 100) * dailyCups, 0) + ' cups/day';
                
                els.optimalValidation.textContent = total === 100 ? 'Total: 100% ‚úì' : `Total: ${total}% - adjust to 100%`;
                els.optimalValidation.className = total === 100 ? 'validation valid' : 'validation invalid';
            }
            
            calculateSavings();
        }

        // Calculate Savings
        function calculateSavings() {
            const currentTotal = Object.values(state.current).reduce((sum, val) => sum + val, 0);
            const optimalTotal = Object.values(state.optimal).reduce((sum, val) => sum + val, 0);
            
            if (currentTotal !== 100 || optimalTotal !== 100) {
                return;
            }
            
            const annualCups = state.teamSize * state.cupsPerDay * state.officeDays * 52;
            
            const currentPaperCups = annualCups * (state.current.paper / 100);
            const currentHandwashCups = annualCups * (state.current.handwash / 100);
            const currentDishwasherCups = annualCups * (state.current.dishwasher / 100);
            
            const optimalPaperCups = annualCups * (state.optimal.paper / 100);
            const optimalInstarinseCups = annualCups * (state.optimal.instarinse / 100);
            const optimalHandwashCups = annualCups * (state.optimal.handwash / 100);
            const optimalDishwasherCups = annualCups * (state.optimal.dishwasher / 100);
            
            const paperCostPerCup = GLOBAL_ASSUMPTIONS.paperCup.cost;
            const handwashCostPerCup = GLOBAL_ASSUMPTIONS.handwash.detergentPerCup + (GLOBAL_ASSUMPTIONS.handwash.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate);
            const dishwasherCostPerCup = (GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad * GLOBAL_ASSUMPTIONS.electricityRate + GLOBAL_ASSUMPTIONS.dishwasher.labourTimePerLoad / 60 * GLOBAL_ASSUMPTIONS.labourRate + GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad) / GLOBAL_ASSUMPTIONS.dishwasher.capacity;
            const instarinseCostPerCup = INSTARINSE_CONSTANTS.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate + INSTARINSE_CONSTANTS.labourTimePerCup * GLOBAL_ASSUMPTIONS.labourRate;
            
            const currentCost = (currentPaperCups * paperCostPerCup) + (currentHandwashCups * handwashCostPerCup) + (currentDishwasherCups * dishwasherCostPerCup);
            const optimalCost = (optimalPaperCups * paperCostPerCup) + (optimalInstarinseCups * instarinseCostPerCup) + (optimalHandwashCups * handwashCostPerCup) + (optimalDishwasherCups * dishwasherCostPerCup);
            
            const currentWater = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad);
            const optimalWater = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.waterPerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad);
            
            const currentCO2 = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad);
            const optimalCO2 = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.co2PerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad);
            
            const currentEnergy = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad);
            const optimalEnergy = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.energyPerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad);
            
            const costSavings = Math.max(0, currentCost - optimalCost);
            const waterSavings = Math.max(0, currentWater - optimalWater);
            const co2Savings = Math.max(0, currentCO2 - optimalCO2);
            const energySavings = Math.max(0, currentEnergy - optimalEnergy);
            
            els.costSavings.textContent = formatCurrency(costSavings);
            els.waterSaved.textContent = formatNumber(waterSavings, 0) + 'L';
            els.co2Saved.textContent = formatNumber(co2Savings, 0) + 'kg';
            els.timeSaved.textContent = formatNumber(energySavings, 0) + ' kWh';
        }

        // Modal Functions
        function openAssumptions() {
            document.getElementById('modalBackdrop').classList.add('open');
            document.getElementById('assumptionsModal').classList.add('open');
        }

        function closeAssumptions() {
            document.getElementById('modalBackdrop').classList.remove('open');
            document.getElementById('assumptionsModal').classList.remove('open');
        }

        function updateCalculations() {
            GLOBAL_ASSUMPTIONS.electricityRate = parseFloat(document.getElementById('electricityRate')?.value) || DEFAULT_ASSUMPTIONS.electricityRate;
            GLOBAL_ASSUMPTIONS.labourRate = parseFloat(document.getElementById('labourRate')?.value) || DEFAULT_ASSUMPTIONS.labourRate;
            GLOBAL_ASSUMPTIONS.paperCup.cost = parseFloat(document.getElementById('paperCupCost')?.value) || DEFAULT_ASSUMPTIONS.paperCup.cost;
            GLOBAL_ASSUMPTIONS.dishwasher.capacity = parseFloat(document.getElementById('dishwasherCapacity')?.value) || DEFAULT_ASSUMPTIONS.dishwasher.capacity;
            GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad = parseFloat(document.getElementById('dishwasherWater')?.value) || DEFAULT_ASSUMPTIONS.dishwasher.waterPerLoad;
            
            calculateSavings();
        }

        // Export to Excel
        function exportToExcel() {
            alert('Export functionality will download a detailed Excel report');
        }

        // Event Listeners
        els.teamSize.addEventListener('input', (e) => { state.teamSize = parseInt(e.target.value) || 1500; updateDailyUsage(); });
        els.officeDays.addEventListener('input', (e) => { state.officeDays = parseInt(e.target.value) || 4; updateDailyUsage(); });
        els.cupsPerDay.addEventListener('input', (e) => { state.cupsPerDay = parseFloat(e.target.value) || 2; updateDailyUsage(); });

        els.currentPaper.addEventListener('input', (e) => { state.current.paper = parseInt(e.target.value); updateSliderDisplay('current'); });
        els.currentHandwash.addEventListener('input', (e) => { state.current.handwash = parseInt(e.target.value); updateSliderDisplay('current'); });
        els.currentDishwasher.addEventListener('input', (e) => { state.current.dishwasher = parseInt(e.target.value); updateSliderDisplay('current'); });

        els.optimalPaper.addEventListener('input', (e) => { state.optimal.paper = parseInt(e.target.value); updateSliderDisplay('optimal'); });
        els.optimalInstarinse.addEventListener('input', (e) => { state.optimal.instarinse = parseInt(e.target.value); updateSliderDisplay('optimal'); });
        els.optimalHandwash.addEventListener('input', (e) => { state.optimal.handwash = parseInt(e.target.value); updateSliderDisplay('optimal'); });
        els.optimalDishwasher.addEventListener('input', (e) => { state.optimal.dishwasher = parseInt(e.target.value); updateSliderDisplay('optimal'); });

        // Initialize
        updateDailyUsage();
    </script>
</body>
</html>
