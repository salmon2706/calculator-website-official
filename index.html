<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>impactOS Saving Estimator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { overflow-x: hidden; }
        
        @media (max-width: 279px) {
            html { 
                zoom: calc(100vw / 280);
                -webkit-text-size-adjust: none;
            }
        }
        
        :root {
            --primary: #90d4f6; --primary-hover: #7cc3f0; --success: #30D158; --warning: #FF9F0A;
            --neutral-50: #FAFAFA; --neutral-100: #F2F2F7; --neutral-200: #E5E5EA; --neutral-300: #D1D1D6;
            --neutral-600: #8E8E93; --neutral-700: #6D6D70; --neutral-800: #48484A; --neutral-900: #1C1C1E;
            --white: #FFFFFF; --glass: rgba(255, 255, 255, 0.8);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            background: #f0f0f0;
            color: var(--neutral-800); -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
            overflow-x: hidden;
        }
        
        .calculator { max-width: 1400px; min-width: 280px; margin: 0 auto; padding: 40px 20px; width: 100%; box-sizing: border-box; }
        
        .header { text-align: center; margin-bottom: 60px; padding: 60px 20px; background: var(--white); border-radius: 24px; border: 1px solid var(--neutral-200); 
                 width: 100%; box-sizing: border-box; }
        .title { font-size: 3rem; font-weight: 800; color: var(--neutral-900); margin-bottom: 50px; letter-spacing: -0.03em; }
        
        .instructions { max-width: 1200px; margin: 0 auto; }
        .instruction-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 30px; 
                           width: 100%; box-sizing: border-box; }
        .instruction-item { display: flex; flex-direction: column; align-items: center; text-align: center; gap: 16px; }
        .instruction-number { width: 40px; height: 40px; min-width: 40px; min-height: 40px; background: linear-gradient(135deg, var(--primary), var(--primary-hover)); 
                            color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
                            font-weight: 700; font-size: 1rem; flex-shrink: 0; box-shadow: 0 4px 12px rgba(144, 212, 246, 0.25); }
        .instruction-number.green { background: linear-gradient(135deg, #22c55e, #16a34a); box-shadow: 0 4px 12px rgba(34, 197, 94, 0.25); }
        .instruction-text h3 { font-size: 1.2rem; font-weight: 700; color: var(--neutral-900); margin-bottom: 8px; }
        .instruction-text p { font-size: 1rem; color: var(--neutral-500); line-height: 1.4; font-weight: 400; }
        .bottom-note { text-align: center; font-size: 1rem; color: var(--primary); font-weight: 600; 
                      padding: 20px 28px; background: linear-gradient(135deg, rgba(144, 212, 246, 0.08), rgba(144, 212, 246, 0.03)); 
                      border-radius: 16px; border: 1px solid rgba(144, 212, 246, 0.15); 
                      box-shadow: 0 2px 8px rgba(144, 212, 246, 0.1); }
        
        .steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 60px; 
                     width: 100%; box-sizing: border-box; }
        
        .step { background: var(--white); border-radius: 20px; padding: 40px; 
               box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); border: 1px solid var(--neutral-200);
               transition: all 0.3s ease; width: 100%; box-sizing: border-box; }
        .step:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        
        .step-header { display: flex; align-items: center; margin-bottom: 30px; flex-wrap: nowrap; }
        .step-number { width: 40px; height: 40px; min-width: 40px; min-height: 40px; background: var(--primary); color: white; border-radius: 50%;
                      display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 16px; flex-shrink: 0; }
        .step-number.green { background: #22c55e; }
        .step-title { font-size: 1.5rem; font-weight: 700; color: var(--neutral-900); }
        
        .input-grid { display: grid; gap: 20px; }
        .input-group { display: flex; flex-direction: column; }
        .label { font-weight: 500; margin-bottom: 8px; color: var(--neutral-700); font-size: 0.95rem; }
        .input { padding: 16px; border: 2px solid var(--neutral-200); border-radius: 12px; font-size: 1rem;
                background: var(--white); transition: all 0.2s; }
        .input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(144, 212, 246, 0.1); }
        .input:hover { border-color: var(--neutral-300); }
        
        .usage-display { background: linear-gradient(135deg, var(--neutral-100) 0%, var(--white) 100%);
                        padding: 24px; border-radius: 16px; text-align: center; margin-top: 20px; border: 1px solid var(--neutral-200); }
        .usage-number { font-size: 2.5rem; font-weight: 700; color: var(--primary); }
        .usage-label { color: var(--neutral-600); margin-top: 4px; font-weight: 400; }
        
        .slider-grid { display: grid; gap: 16px; }
        .slider-row { display: flex; align-items: center; gap: 12px; padding: 16px; background: var(--neutral-50);
                     border-radius: 12px; transition: all 0.2s; width: 100%; box-sizing: border-box; }
        .slider-control-row { display: contents; }
        .slider-row:hover { background: var(--neutral-100); }
        
        .slider-color { width: 20px; height: 20px; border-radius: 50%; flex-shrink: 0; }
        .slider-color.paper { background: var(--warning); }
        .slider-color.handwash { background: #FF6B6B; }
        .slider-color.dishwasher { background: var(--primary); }
        .slider-color.instarinse { background: #22c55e; }
        
        .slider-label { font-weight: 500; min-width: 60px; color: var(--neutral-800); flex-shrink: 1; font-size: 0.9rem; }
        .slider { flex: 1; height: 6px; border-radius: 3px; background: var(--neutral-200); outline: none;
                 -webkit-appearance: none; appearance: none; cursor: pointer; min-width: 60px; max-width: 100%; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%;
                                       background: var(--primary); cursor: pointer; box-shadow: 0 2px 8px rgba(144, 212, 246, 0.3); }
        .slider::-moz-range-thumb { width: 24px; height: 24px; border-radius: 50%; background: var(--primary); 
                                   cursor: pointer; border: none; box-shadow: 0 2px 8px rgba(144, 212, 246, 0.3); }
        .slider-value { font-weight: 600; color: var(--primary); min-width: 35px; text-align: right; flex-shrink: 0; }
        
        .cups-display { font-size: 0.85rem; color: var(--neutral-600); text-align: center; margin-top: 4px; margin-bottom: 12px;
                       padding: 4px 8px; background: var(--neutral-100); border-radius: 6px; font-weight: 500; }
        
        .validation { margin-top: 16px; padding: 12px 20px; border-radius: 10px; font-weight: 500; text-align: center; }
        .valid { background: rgba(48, 209, 88, 0.1); color: #1B7B3A; border: 1px solid rgba(48, 209, 88, 0.2); }
        .invalid { background: rgba(255, 105, 97, 0.1); color: #D1242F; border: 1px solid rgba(255, 105, 97, 0.2); }
        
        .comparisons-section { background: var(--white); border-radius: 24px; padding: 50px; margin: 60px 0;
                              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04); border: 1px solid var(--neutral-200); 
                              width: 100%; box-sizing: border-box; }
        
        .comparisons-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .comparisons-title-wrapper { display: flex; align-items: center; }
        .comparisons-title { font-size: 2.2rem; font-weight: 800; color: var(--neutral-900); letter-spacing: -0.01em; }
        .adjust-btn { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 12px;
                     font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .adjust-btn:hover { background: var(--primary-hover); transform: translateY(-1px); }
        
        .comparison-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        .comparison-card.instarinse { grid-column: 2; margin-top: 24px; position: relative; overflow: hidden; }
        .comparison-card { background: var(--white); border: 1px solid var(--neutral-200); border-radius: 16px;
                          padding: 24px; transition: all 0.3s; position: relative; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .comparison-card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .comparison-card.instarinse { border-color: #22c55e; background: rgba(34, 197, 94, 0.02); 
                                     border-width: 2px; box-shadow: 0 4px 20px rgba(34, 197, 94, 0.25), 0 0 0 1px rgba(34, 197, 94, 0.1); }
        .comparison-card.instarinse::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; 
                                            background: linear-gradient(90deg, #22c55e, #16a34a); }
        .comparison-card.instarinse .method-name { color: #16a34a; font-weight: 700; }
        .comparison-card.instarinse .method-cost { color: #16a34a; }
        .comparison-card.instarinse:hover { border-color: #16a34a; transform: translateY(-3px); 
                                          box-shadow: 0 8px 30px rgba(34, 197, 94, 0.35), 0 0 0 2px rgba(34, 197, 94, 0.15); }
        
        .method-name { font-size: 1.2rem; font-weight: 600; margin-bottom: 8px; color: var(--neutral-900); }
        .method-cost { font-size: 2.2rem; font-weight: 700; color: var(--primary); margin-bottom: 20px; }
        .method-cost small { font-size: 0.75rem; font-weight: 400; color: var(--neutral-600); margin-left: 4px; }
        
        .details-grid { display: grid; gap: 8px; margin-bottom: 16px; }
        .detail-item { display: flex; justify-content: space-between; align-items: center; font-size: 1rem; margin-bottom: 8px; }
        .detail-label { color: var(--neutral-900); font-weight: 600; }
        .detail-label .per-text { font-size: 0.65rem; color: var(--neutral-500); font-weight: 400; margin-left: 4px; }
        .detail-value { font-weight: 600; color: var(--neutral-800); }
        
        .method-note { font-size: 0.85rem; color: var(--neutral-600); font-style: italic; margin-top: 12px; }
        
        .results-section { margin: 60px 0; }
        .results-cards { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%); 
                        border-radius: 24px; padding: 50px; margin-bottom: 60px; color: white; text-align: center; 
                        width: 100%; box-sizing: border-box; box-shadow: 0 8px 32px rgba(144, 212, 246, 0.3); }
        .results-title { font-size: 2.8rem; font-weight: 800; margin-bottom: 0; letter-spacing: -0.02em; }
        .results-title-wrapper { display: flex; align-items: center; justify-content: center; margin-bottom: 40px; }
        .results-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px; }
        .result-card { background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(20px);
                      padding: 35px 30px; border-radius: 18px; border: 1px solid rgba(255, 255, 255, 0.3); 
                      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
                      transition: all 0.3s ease; }
        .result-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15), 0 2px 5px rgba(0, 0, 0, 0.12); }
        .result-value { font-size: 2.8rem; font-weight: 700; margin-bottom: 12px; line-height: 1.1; letter-spacing: -0.02em; }
        .result-label { font-size: 1.05rem; opacity: 0.95; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .breakdown-section { background: var(--white); border-radius: 20px; padding: 40px; 
                           box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); border: 1px solid var(--neutral-200); 
                           width: 100%; box-sizing: border-box; }
        .breakdown-title { font-size: 2rem; font-weight: 800; color: var(--neutral-900); margin: 40px 0 40px 0; padding: 20px 0; letter-spacing: -0.01em; text-align: center; }
        
        .table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .table th { background: var(--neutral-100); padding: 20px; font-weight: 600; color: var(--neutral-700);
                   border-bottom: 2px solid var(--neutral-200); font-size: 0.95rem; }
        .table th:first-child { border-top-left-radius: 12px; }
        .table th:last-child { border-top-right-radius: 12px; }
        .table td { padding: 20px; border-bottom: 1px solid var(--neutral-200); font-size: 1rem; }
        .table tr:hover { background: var(--neutral-50); }
        .table tr:last-child td:first-child { border-bottom-left-radius: 12px; }
        .table tr:last-child td:last-child { border-bottom-right-radius: 12px; }
        
        .savings { color: var(--primary); font-weight: 600; }
        .current-value { color: var(--neutral-700); font-weight: 500; }
        .optimised-value { color: var(--neutral-900); font-weight: 600; }
        .expandable-row { cursor: pointer; transition: background-color 0.2s; }
        .expandable-row:hover { background: var(--neutral-100); }
        .expand-icon { margin-left: 8px; color: var(--neutral-600); transition: transform 0.3s; }
        .expand-icon.rotated { transform: rotate(180deg); }
        .breakdown-details { display: none; background: var(--neutral-50); }
        .breakdown-details.open { display: table-row; }
        .breakdown-details td { padding: 12px 20px; font-size: 0.9rem; color: var(--neutral-700); border-bottom: 1px solid var(--neutral-300); }
        .method-breakdown { display: flex; justify-content: space-between; margin: 4px 0; }
        
        .impact-cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; margin-top: 40px; width: 100%; box-sizing: border-box; }
        
        @media (min-width: 1200px) {
            .impact-cards { grid-template-columns: repeat(2, 1fr); gap: 40px; }
        }
        .impact-card { background: var(--white); border-radius: 20px; padding: 30px; border: 2px solid var(--neutral-200); 
                      box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: all 0.3s ease; cursor: pointer; position: relative; 
                      width: 100%; box-sizing: border-box; min-width: 0; }
        .impact-header { display: flex; align-items: center; margin-bottom: 20px; min-width: 0; }
        .impact-icon { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; 
                      font-size: 1.1rem; font-weight: 700; margin-right: 16px; flex-shrink: 0; }
        .cost-icon { background: linear-gradient(135deg, #90d4f6, #7cc3f0); color: white; }
        .water-icon { background: linear-gradient(135deg, #B8E6B8, #90D190); color: white; }
        .carbon-icon { background: linear-gradient(135deg, #D4C5F9, #B8A9F9); color: white; }
        .energy-icon { background: linear-gradient(135deg, #FFE5B8, #FFD190); color: white; }
        .impact-title { font-size: 1.1rem; font-weight: 600; color: var(--neutral-900); display: flex; align-items: center; flex-wrap: wrap; 
                       flex: 1; min-width: 0; }
        .impact-comparison { display: flex; align-items: center; gap: 15px; margin: 20px 0; }
        .comparison-value { text-align: center; flex: 1; min-width: 0; }
        .comparison-label { font-size: 0.8rem; color: var(--neutral-600); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.3px; 
                          word-wrap: break-word; overflow-wrap: break-word; hyphens: none; line-height: 1.3; 
                          white-space: normal; max-width: 100%; }
        .comparison-number { font-size: 1.8rem; font-weight: 700; }
        .current-number { color: var(--neutral-700); }
        .optimised-number { color: var(--neutral-900); }
        .comparison-arrow { color: var(--primary); font-size: 1.5rem; font-weight: 600; opacity: 0.8; flex-shrink: 0; }
        .savings-highlight { background: linear-gradient(135deg, var(--primary), var(--primary-hover)); 
                           color: white; padding: 15px 20px; border-radius: 12px; text-align: center; margin-top: 15px; }
        .savings-amount { font-size: 1.4rem; font-weight: 700; display: block; }
        .savings-percent { font-size: 1rem; opacity: 0.9; font-weight: 700; }
        
        .impact-breakdown { margin-top: 20px; padding: 20px; background: var(--neutral-50); border-radius: 12px; 
                           display: none; border-top: 1px solid var(--neutral-200); animation: slideDown 0.3s ease; }
        .impact-breakdown.open { display: block; }
        .breakdown-method { display: grid; grid-template-columns: 1fr auto; gap: 15px; align-items: center; 
                           margin: 12px 0; padding: 12px; background: var(--white); border-radius: 8px; 
                           border: 1px solid var(--neutral-200); }
        .breakdown-method:last-child { margin-bottom: 0; }
        .method-name { font-weight: 600; color: var(--neutral-800); font-size: 0.95rem; }
        .method-values { display: flex; align-items: center; gap: 12px; font-size: 0.9rem; }
        .current-val { color: var(--neutral-600); font-weight: 500; }
        .optimal-val { color: var(--neutral-900); font-weight: 600; }
        .method-values span:nth-child(2) { color: var(--primary); font-weight: 600; }
        
        .expand-indicator { margin-left: 8px; color: var(--primary); font-size: 1rem; transition: transform 0.3s; 
                           background: rgba(144, 212, 246, 0.15); width: 24px; height: 24px; border-radius: 50%; font-weight: 700; 
                           border: 1px solid rgba(144, 212, 246, 0.2); white-space: nowrap; flex-shrink: 0; 
                           display: flex; align-items: center; justify-content: center; }
        .expand-indicator.rotated { transform: rotate(180deg); }
        .expand-indicator.rotated { content: '−'; }
        .expand-indicator:not(.rotated) { content: '+'; }
        
        .expand-indicator.rotated { background: rgba(144, 212, 246, 0.2); }
        
        
        @keyframes slideDown { 
            from { opacity: 0; transform: translateY(-10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(8px);
                         z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-backdrop.open { opacity: 1; visibility: visible; }
        
        .assumptions-modal { position: fixed; top: 0; right: -90vw; width: 90vw; max-width: 600px; height: 100vh;
                           background: var(--white); z-index: 1000; transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                           overflow-y: auto; border-left: 1px solid var(--neutral-200); }
        .assumptions-modal.open { right: 0; }
        
        .modal-header { padding: 30px; border-bottom: 1px solid var(--neutral-200); background: var(--neutral-50); }
        .modal-title { font-size: 1.5rem; font-weight: 700; color: var(--neutral-900); margin-bottom: 8px; }
        .modal-subtitle { color: var(--neutral-600); font-size: 1rem; }
        .close-btn { position: absolute; top: 20px; right: 20px; background: var(--neutral-200); border: none;
                    width: 32px; height: 32px; border-radius: 50%; cursor: pointer; transition: all 0.2s;
                    z-index: 1001; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        .close-btn:hover { background: var(--neutral-300); }
        .close-btn:active { background: var(--neutral-400); transform: scale(0.95); }
        
        .modal-content { padding: 30px; }
        .assumption-group { margin-bottom: 40px; padding: 24px; background: var(--neutral-50); border-radius: 16px; }
        .group-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 20px; color: var(--neutral-900); }
        .assumption-item { margin-bottom: 20px; }
        .assumption-label { display: block; font-weight: 500; margin-bottom: 8px; color: var(--neutral-700); }
        .assumption-row { display: flex; align-items: center; gap: 12px; }
        .assumption-input { padding: 12px; border: 2px solid var(--neutral-200); border-radius: 8px;
                           width: 120px; font-size: 1rem; }
        .assumption-input:focus { border-color: var(--primary); outline: none; }
        .assumption-input.modified { border-color: var(--warning); background: rgba(255, 159, 10, 0.05); }
        .assumption-unit { color: var(--neutral-600); font-size: 0.9rem; }
        .reset-btn { background: none; border: none; cursor: pointer; padding: 8px; border-radius: 6px; }
        .reset-btn:hover { background: var(--neutral-200); }
        .reset-btn svg { width: 16px; height: 16px; fill: var(--neutral-600); }
        .assumption-source { font-size: 0.8rem; color: var(--neutral-600); margin-top: 6px; }
        .source-link { color: var(--primary); text-decoration: none; }
        .source-link:hover { text-decoration: underline; }
        
        .hidden { display: none !important; }
        
        @media (max-width: 1024px) and (min-width: 641px) {
            .calculator { padding: 15px; }
            .header { padding: 40px 15px; }
            .steps-grid { grid-template-columns: 1fr; gap: 15px; }
            .comparison-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .comparison-card.instarinse { grid-column: 1 / -1; justify-self: center; max-width: 300px; }
            .results-grid { grid-template-columns: repeat(2, 1fr); gap: 25px; }
            .result-card { padding: 25px 20px; }
            .result-value { font-size: 2.2rem; }
            .instruction-grid { grid-template-columns: repeat(3, 1fr); gap: 24px; }
            
            .table { font-size: 0.9rem; }
            .table th, .table td { padding: 12px 8px; }
            
            .impact-cards { grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0; }
            .impact-card { padding: 15px; min-width: 0; }
            .expand-indicator { font-size: 0.7rem; width: 18px; height: 18px; margin-left: 4px; }
            .impact-title { font-size: 1rem; }
            .comparison-label { font-size: 0.75rem; letter-spacing: 0.2px; }
            .comparison-number { font-size: 1.6rem; }
            .comparison-arrow { font-size: 1.3rem; padding: 4px; }
            
            .slider-control-row { display: contents; }
        }
        
        @media (max-width: 640px) {
            .title { font-size: 2rem; }
            .header { padding: 30px 10px; }
            .instruction-grid { grid-template-columns: repeat(2, 1fr); gap: 20px; }
            .comparison-grid { grid-template-columns: 1fr; }
            .comparison-card.instarinse { grid-column: 1; max-width: none; }
            .results-grid { grid-template-columns: 1fr; gap: 25px; }
            .result-card { padding: 25px 20px; }
            .result-value { font-size: 2.4rem; }
            .result-label { font-size: 0.95rem; }
            .results-title-wrapper { flex-direction: column; gap: 12px; }
            .comparisons-header { flex-direction: column; gap: 20px; align-items: stretch; }
            .comparisons-title-wrapper { flex-direction: column; gap: 12px; align-items: flex-start; }
            .instruction-text h3 { font-size: 0.95rem; }
            .instruction-text p { font-size: 0.85rem; }
            
            .step { padding: 15px; }
            
            .slider-row { flex-direction: column; gap: 12px; padding: 16px; align-items: stretch; }
            .slider-label { min-width: 0; font-size: 1rem; text-align: center; margin-bottom: 0; font-weight: 600; }
            .slider-control-row { display: flex; align-items: center; gap: 12px; }
            .slider { min-width: 0; flex: 1; }
            .slider-value { min-width: 40px; font-size: 1rem; }
            
            .comparisons-header { flex-direction: column; gap: 20px; text-align: center; }
            .adjust-btn { padding: 10px 20px; font-size: 0.9rem; width: auto; min-width: 160px; }
            
            .assumptions-modal { 
                width: 100vw; 
                right: -100vw; 
                left: auto; 
                top: 0;
                height: 100vh; 
                max-height: 100vh;
                border-radius: 0;
                border-left: none;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            .assumptions-modal.open { right: 0; }
            .modal-header { padding: 20px; position: sticky; top: 0; z-index: 10; background: var(--neutral-50); }
            .modal-content { padding: 20px; padding-bottom: 80px; }
            .assumption-group { padding: 16px; margin-bottom: 20px; }
            .assumption-row { flex-wrap: wrap; gap: 8px; }
            .assumption-input { width: 100px; font-size: 0.9rem; padding: 8px; }
            .assumption-unit { font-size: 0.8rem; }
            .close-btn { 
                position: fixed;
                top: 20px; 
                right: 20px; 
                width: 44px; 
                height: 44px; 
                font-size: 1.6rem;
                background: var(--neutral-700);
                color: white;
                z-index: 1010;
                border: 2px solid var(--white);
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                font-weight: bold;
                line-height: 1;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .close-btn:hover {
                background: var(--neutral-800);
            }
            .close-btn:active {
                background: var(--neutral-900);
                transform: scale(0.95);
            }
            
            .table-container { 
                width: 100%;
                margin: 0;
                padding: 0;
                border-radius: 12px;
            }
            .table { width: 100%; font-size: 0.8rem; }
            .table th, .table td { padding: 8px 4px; word-break: break-word; }
            .table th { font-size: 0.75rem; }
            .method-breakdown { flex-direction: column; gap: 8px; }
            .method-breakdown span { font-size: 0.8rem; display: block; }
            
            .table-container::after {
                content: '← Scroll for more →';
                position: absolute;
                bottom: -25px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 0.7rem;
                color: var(--neutral-500);
                pointer-events: none;
            }
            
            .calculator { padding: 10px; max-width: 100vw; }
            .comparisons-section { padding: 25px 10px; margin: 20px 0; }
            .breakdown-section { padding: 25px 10px; position: relative; }
            .breakdown-title { margin: 30px 0 30px 0; padding: 15px 0; font-size: 1.8rem; }
            .results-cards { padding: 30px 10px; }
            .results-title-wrapper { flex-direction: column; gap: 15px; }
            .results-title { font-size: 2.2rem; }
            .comparisons-title-wrapper { flex-direction: column; gap: 15px; align-items: flex-start; }
            .comparisons-title { font-size: 1.8rem; }
            
            .validation { padding: 10px 16px; font-size: 0.9rem; }
            .cups-display { font-size: 0.8rem; padding: 3px 6px; }
            
            .impact-cards { grid-template-columns: 1fr; gap: 20px; }
            .impact-card { padding: 15px; }
            .impact-title { font-size: 0.95rem; }
            .impact-icon { width: 40px; height: 40px; font-size: 0.9rem; margin-right: 12px; }
            .expand-indicator { font-size: 0.7rem; width: 18px; height: 18px; margin-left: 4px; }
            .impact-comparison { flex-direction: column; gap: 15px; text-align: center; }
            .comparison-arrow { transform: rotate(90deg); font-size: 1.2rem; padding: 8px; }
            .comparison-number { font-size: 1.4rem; }
            .comparison-label { font-size: 0.7rem; letter-spacing: 0.1px; }
            .savings-highlight { padding: 12px 16px; }
            .savings-amount { font-size: 1.2rem; }
            .impact-breakdown { padding: 15px; }
            .breakdown-method { grid-template-columns: 1fr; gap: 8px; text-align: center; padding: 10px; }
            .method-values { justify-content: center; gap: 10px; flex-wrap: wrap; }
            .expand-indicator { font-size: 0.75rem; padding: 3px 6px; margin-left: 6px; }
        }

        @media (max-width: 500px) {
            .comparison-label { font-size: 0.68rem; letter-spacing: 0.1px; }
            .comparison-number { font-size: 1.3rem; }
            .comparison-arrow { font-size: 1.1rem; padding: 6px; }
            .impact-comparison { gap: 12px; }
        }

        @media (max-width: 480px) {
            .instruction-grid { grid-template-columns: 1fr; gap: 16px; }
        }

        @media (max-width: 400px) {
            .comparison-label { font-size: 0.65rem; letter-spacing: 0px; line-height: 1.2; }
            .comparison-number { font-size: 1.2rem; }
            .comparison-arrow { font-size: 1rem; padding: 4px; }
            .impact-comparison { gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="calculator">
        <header class="header">
            <h1 class="title">Calculate your savings</h1>
            <div class="instructions">
                <div class="instruction-grid">
                    <div class="instruction-item">
                        <div class="instruction-number">1</div>
                        <div class="instruction-text">
                            <h3>Your Site</h3>
                            <p>Site users, days, and cup usage</p>
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">2</div>
                        <div class="instruction-text">
                            <h3>Your Current Mix</h3>
                            <p>How you serve and clean today</p>
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">3</div>
                        <div class="instruction-text">
                            <h3>With instarinse®</h3>
                            <p>Your optimised workflow</p>
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number">4</div>
                        <div class="instruction-text">
                            <h3>Fine-tune</h3>
                            <p>Adjust costs and assumptions</p>
                        </div>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-number green">5</div>
                        <div class="instruction-text">
                            <h3>Your Annual Impact</h3>
                            <p>See your cost savings and results</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="steps-grid">
            <div class="step">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h2 class="step-title">Your Site</h2>
                </div>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label class="label" for="teamSize">Site Users</label>
                        <input type="number" id="teamSize" class="input" value="1500" min="10" max="50000">
                    </div>
                    
                    <div class="input-group">
                        <label class="label" for="officeDays">Operating Days/Week</label>
                        <input type="number" id="officeDays" class="input" value="4" min="1" max="7">
                    </div>
                    
                    <div class="input-group">
                        <label class="label" for="cupsPerDay">Cups per Person/Day</label>
                        <input type="number" id="cupsPerDay" class="input" value="2" min="1" max="10" step="0.5">
                    </div>
                </div>
                
                <div class="usage-display">
                    <div class="usage-number" id="dailyUsage">1,000</div>
                    <div class="usage-label">cups per day average</div>
                </div>
            </div>

            <div class="step">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h2 class="step-title">Your Current Mix</h2>
                </div>
                
                <div class="slider-grid">
                    <div class="slider-row">
                        <div class="slider-label">Paper Cups</div>
                        <div class="slider-control-row">
                            <div class="slider-color paper"></div>
                        <input type="range" class="slider" id="currentPaper" min="0" max="100" value="30" step="5">
                        <div class="slider-value" id="currentPaperValue">30%</div>
                        </div>
                    </div>
                    <div class="cups-display" id="currentPaperCups">300 cups/day</div>
                    
                    <div class="slider-row">
                        <div class="slider-label">Hand Washing</div>
                        <div class="slider-control-row">
                            <div class="slider-color handwash"></div>
                        <input type="range" class="slider" id="currentHandwash" min="0" max="100" value="20" step="5">
                        <div class="slider-value" id="currentHandwashValue">20%</div>
                        </div>
                    </div>
                    <div class="cups-display" id="currentHandwashCups">200 cups/day</div>
                    
                    <div class="slider-row">
                        <div class="slider-label">Dishwasher</div>
                        <div class="slider-control-row">
                            <div class="slider-color dishwasher"></div>
                        <input type="range" class="slider" id="currentDishwasher" min="0" max="100" value="50" step="5">
                        <div class="slider-value" id="currentDishwasherValue">50%</div>
                        </div>
                    </div>
                    <div class="cups-display" id="currentDishwasherCups">500 cups/day</div>
                </div>
                
                <div class="validation" id="currentValidation">Adjust to total 100%</div>
            </div>

            <div class="step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h2 class="step-title">With instarinse®</h2>
                </div>
                
                <div class="slider-grid">
                    <div class="slider-row">
                        <div class="slider-label">Paper Cups</div>
                        <div class="slider-control-row">
                            <div class="slider-color paper"></div>
                        <input type="range" class="slider" id="optimalPaper" min="0" max="100" value="0" step="5">
                        <div class="slider-value" id="optimalPaperValue">0%</div>
                        </div>
                    </div>
                    <div class="cups-display" id="optimalPaperCups">50 cups/day</div>
                    
                    <div class="slider-row">
                        <div class="slider-label">instarinse®</div>
                        <div class="slider-control-row">
                            <div class="slider-color instarinse"></div>
                        <input type="range" class="slider" id="optimalInstarinse" min="0" max="100" value="70" step="5">
                        <div class="slider-value" id="optimalInstarinseValue">70%</div>
                        </div>
                    </div>
                    <div class="cups-display" id="optimalInstarinseCups">700 cups/day</div>
                    
                    <div class="slider-row">
                        <div class="slider-label">Hand Washing</div>
                        <div class="slider-control-row">
                            <div class="slider-color handwash"></div>
                        <input type="range" class="slider" id="optimalHandwash" min="0" max="100" value="10" step="5">
                        <div class="slider-value" id="optimalHandwashValue">10%</div>
                        </div>
                    </div>
                    <div class="cups-display" id="optimalHandwashCups">100 cups/day</div>
                    
                    <div class="slider-row">
                        <div class="slider-label">Dishwasher</div>
                        <div class="slider-control-row">
                            <div class="slider-color dishwasher"></div>
                        <input type="range" class="slider" id="optimalDishwasher" min="0" max="100" value="20" step="5">
                        <div class="slider-value" id="optimalDishwasherValue">20%</div>
                        </div>
                    </div>
                    <div class="cups-display" id="optimalDishwasherCups">150 cups/day</div>
                </div>
                
                <div class="validation" id="optimalValidation">Adjust to total 100%</div>
            </div>
        </section>

        <section class="comparisons-section">
            <div class="comparisons-header">
                <div class="comparisons-title-wrapper">
                    <div class="step-number">4</div>
                    <h2 class="comparisons-title">The Numbers</h2>
                </div>
                <button class="adjust-btn" onclick="openAssumptions()">Adjust Assumptions</button>
            </div>
            
            <div class="comparison-grid">
                <div class="comparison-card">
                    <div class="method-name">Paper Cup</div>
                    <div class="method-cost"><span id="paperCostDisplay">15</span>p <small>(per cup)</small></div>
                    <div class="details-grid">
                        <div class="detail-item"><span class="detail-label">Cost <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="paperCostOnly">15</span>p</span></div>
                        <div class="detail-item"><span class="detail-label">Water <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="paperWaterOnly">0.25</span>L</span></div>
                        <div class="detail-item"><span class="detail-label">CO₂ <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="paperCo2Only">10</span>g</span></div>
                        <div class="detail-item"><span class="detail-label">Energy <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="paperEnergyOnly">0.06</span>kWh</span></div>
                        <div class="detail-item"><span class="detail-label">Labour <span class="per-text">(per cup)</span></span> <span class="detail-value">0 sec</span></div>
                    </div>
                    <div class="method-note">Manufacturing + disposal costs</div>
                </div>
                
                <div class="comparison-card">
                    <div class="method-name">Hand Washing</div>
                    <div class="method-cost"><span id="handwashCostDisplay">3</span>p <small>(per cup)</small></div>
                    <div class="details-grid">
                        <div class="detail-item"><span class="detail-label">Detergent <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="handwashDetergentOnly">1</span>p</span></div>
                        <div class="detail-item"><span class="detail-label">Water <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="handwashWaterOnly">1.0</span>L</span></div>
                        <div class="detail-item"><span class="detail-label">CO₂ <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="handwashCo2Only">20</span>g</span></div>
                        <div class="detail-item"><span class="detail-label">Energy <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="handwashEnergyOnly">0.08</span>kWh</span></div>
                        <div class="detail-item"><span class="detail-label">Labour <span class="per-text">(per cup)</span></span> <span class="detail-value">0 sec</span></div>
                    </div>
                    <div class="method-note">Self-service (no labour cost)</div>
                </div>
                
                <div class="comparison-card">
                    <div class="method-name">Dishwasher</div>
                    <div class="method-cost"><span id="dishwasherCostDisplay">6</span>p <small>(per cup)</small></div>
                    <div class="details-grid">
                        <div class="detail-item"><span class="detail-label">Total cost <span class="per-text">(per load)</span></span> <span class="detail-value">£<span id="dishwasherLoadCost">2.40</span></span></div>
                        <div class="detail-item"><span class="detail-label">Water <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="dishwasherWaterOnly">0.33</span>L</span></div>
                        <div class="detail-item"><span class="detail-label">CO₂ <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="dishwasherCo2Only">4</span>g</span></div>
                        <div class="detail-item"><span class="detail-label">Energy <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="dishwasherEnergyOnly">0.02</span>kWh</span></div>
                        <div class="detail-item"><span class="detail-label">Labour time <span class="per-text">(per load)</span></span> <span class="detail-value"><span id="dishwasherLabourTime">10</span> min</span></div>
                    </div>
                    <div class="method-note"><span id="dishwasherCapacityNote">40</span> cups per load • Includes loading/unloading</div>
                </div>
                
                <div class="comparison-card instarinse">
                    <div class="method-name">instarinse®</div>
                    <div class="method-cost"><span id="instarinseCostDisplay">1.2</span>p <small>(per cup)</small></div>
                    <div class="details-grid">
                        <div class="detail-item"><span class="detail-label">Operation cost <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="instarinseOpOnly">1.2</span>p</span></div>
                        <div class="detail-item"><span class="detail-label">Water <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="instarinseWaterOnly">50</span>ml</span></div>
                        <div class="detail-item"><span class="detail-label">CO₂ <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="instarinseCo2Only">0</span>g</span></div>
                        <div class="detail-item"><span class="detail-label">Energy <span class="per-text">(per cup)</span></span> <span class="detail-value"><span id="instarinseEnergyOnly">0.01</span>kWh</span></div>
                        <div class="detail-item"><span class="detail-label">Maintenance <span class="per-text">(per 100 cups)</span></span> <span class="detail-value"><span id="instarinseLabourTime">5</span> min</span></div>
                    </div>
                    <div class="method-note">Maintenance includes tank changes & daily cleaning</div>
                </div>
            </div>
        </section>

        <section class="results-section" id="resultsSection">
            <div class="results-cards">
                <div class="results-title-wrapper">
                    <div class="step-number green">5</div>
                    <h2 class="results-title">Your Annual Impact</h2>
                </div>
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-value" id="costSavings">£15,000</div>
                        <div class="result-label">Cost Savings</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="waterSaved">3,250,000</div>
                        <div class="result-label">Water Conserved</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="co2Saved">4,500</div>
                        <div class="result-label">CO₂ Eliminated</div>
                    </div>
                    <div class="result-card">
                        <div class="result-value" id="timeSaved">1,700</div>
                        <div class="result-label">Energy Saved</div>
                    </div>
                </div>
            </div>
            
            <div class="breakdown-section" id="breakdownSection">
                <h3 class="breakdown-title">The Breakdown</h3>
                <p style="text-align: center; color: var(--neutral-600); margin-bottom: 30px; font-size: 1rem;">Click any card to see detailed breakdown by cleaning method</p>
                
                <div class="impact-cards">
                    <div class="impact-card" onclick="toggleImpactBreakdown('cost')">
                        <div class="impact-header">
                            <div class="impact-icon cost-icon">£</div>
                            <div class="impact-title">Annual Cost <span class="expand-indicator" id="costIndicator">+</span></div>
                                </div>
                        <div class="impact-comparison">
                            <div class="comparison-value">
                                <div class="comparison-label">Current</div>
                                <div class="comparison-number current-number" id="currentCost">£25,000</div>
                                </div>
                            <div class="comparison-arrow">→</div>
                            <div class="comparison-value">
                                <div class="comparison-label">With instarinse®</div>
                                <div class="comparison-number optimised-number" id="newCost">£10,000</div>
                                </div>
                                </div>
                        <div class="savings-highlight">
                            <span class="savings-amount" id="savingsCost">£15,000</span>
                            <span class="savings-percent">saved (<span id="savingsPercent">60%</span>)</span>
                        </div>
                        <div class="impact-breakdown" id="costBreakdownImpact">
                            <div class="breakdown-method">
                                <span class="method-name">Paper cups</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentPaperCostBreakdown">£8,000</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalPaperCostBreakdown">£400</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Hand washing</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentHandwashCostBreakdown">£600</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalHandwashCostBreakdown">£150</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Dishwasher</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentDishwasherCostBreakdown">£16,400</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalDishwasherCostBreakdown">£4,920</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">instarinse®</span>
                                <div class="method-values">
                                    <span class="current-val">£0</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalInstarinseCostBreakdown">£4,980</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="impact-card" onclick="toggleImpactBreakdown('water')">
                        <div class="impact-header">
                            <div class="impact-icon water-icon">H₂O</div>
                            <div class="impact-title">Water Usage <span class="expand-indicator" id="waterIndicator">+</span></div>
                        </div>
                        <div class="impact-comparison">
                            <div class="comparison-value">
                                <div class="comparison-label">Current</div>
                                <div class="comparison-number current-number" id="currentWater">3,500,000L</div>
                            </div>
                            <div class="comparison-arrow">→</div>
                            <div class="comparison-value">
                                <div class="comparison-label">With instarinse®</div>
                                <div class="comparison-number optimised-number" id="newWater">250,000L</div>
                            </div>
                        </div>
                        <div class="savings-highlight">
                            <span class="savings-amount" id="savingsWater">3,250,000L</span>
                            <span class="savings-percent">saved (<span id="waterPercent">93%</span>)</span>
                        </div>
                        <div class="impact-breakdown" id="waterBreakdownImpact">
                            <div class="breakdown-method">
                                <span class="method-name">Paper cups</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentPaperWaterBreakdown">7,500L</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalPaperWaterBreakdown">1,250L</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Hand washing</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentHandwashWaterBreakdown">20,000L</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalHandwashWaterBreakdown">10,000L</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Dishwasher</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentDishwasherWaterBreakdown">330,000L</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalDishwasherWaterBreakdown">99,000L</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">instarinse®</span>
                                <div class="method-values">
                                    <span class="current-val">0L</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalInstarinseWaterBreakdown">175,000L</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="impact-card" onclick="toggleImpactBreakdown('co2')">
                        <div class="impact-header">
                            <div class="impact-icon carbon-icon">CO₂</div>
                            <div class="impact-title">Carbon Emissions <span class="expand-indicator" id="co2Indicator">+</span></div>
                        </div>
                        <div class="impact-comparison">
                            <div class="comparison-value">
                                <div class="comparison-label">Current</div>
                                <div class="comparison-number current-number" id="currentCo2">6,000kg</div>
                            </div>
                            <div class="comparison-arrow">→</div>
                            <div class="comparison-value">
                                <div class="comparison-label">With instarinse®</div>
                                <div class="comparison-number optimised-number" id="newCo2">1,500kg</div>
                            </div>
                        </div>
                        <div class="savings-highlight">
                            <span class="savings-amount" id="savingsCo2">4,500kg</span>
                            <span class="savings-percent">saved (<span id="co2Percent">75%</span>)</span>
                        </div>
                        <div class="impact-breakdown" id="co2BreakdownImpact">
                            <div class="breakdown-method">
                                <span class="method-name">Paper cups</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentPaperCo2Breakdown">360kg</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalPaperCo2Breakdown">60kg</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Hand washing</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentHandwashCo2Breakdown">400kg</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalHandwashCo2Breakdown">200kg</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Dishwasher</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentDishwasherCo2Breakdown">200kg</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalDishwasherCo2Breakdown">60kg</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">instarinse®</span>
                                <div class="method-values">
                                    <span class="current-val">0kg</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalInstarinseCo2Breakdown">140kg</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="impact-card" onclick="toggleImpactBreakdown('energy')">
                        <div class="impact-header">
                            <div class="impact-icon energy-icon">kWh</div>
                            <div class="impact-title">Energy Usage <span class="expand-indicator" id="energyIndicator">+</span></div>
                        </div>
                        <div class="impact-comparison">
                            <div class="comparison-value">
                                <div class="comparison-label">Current</div>
                                <div class="comparison-number current-number" id="currentEnergy">2,500 kWh</div>
                            </div>
                            <div class="comparison-arrow">→</div>
                            <div class="comparison-value">
                                <div class="comparison-label">With instarinse®</div>
                                <div class="comparison-number optimised-number" id="newEnergy">800 kWh</div>
                            </div>
                        </div>
                        <div class="savings-highlight">
                            <span class="savings-amount" id="savingsEnergy">1,700 kWh</span>
                            <span class="savings-percent">saved (<span id="energyPercent">68%</span>)</span>
                        </div>
                        <div class="impact-breakdown" id="energyBreakdownImpact">
                            <div class="breakdown-method">
                                <span class="method-name">Paper cups</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentPaperEnergyBreakdown">1,800 kWh</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalPaperEnergyBreakdown">300 kWh</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Hand washing</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentHandwashEnergyBreakdown">1,600 kWh</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalHandwashEnergyBreakdown">800 kWh</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">Dishwasher</span>
                                <div class="method-values">
                                    <span class="current-val" id="currentDishwasherEnergyBreakdown">225 kWh</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalDishwasherEnergyBreakdown">67.5 kWh</span>
                                </div>
                            </div>
                            <div class="breakdown-method">
                                <span class="method-name">instarinse®</span>
                                <div class="method-values">
                                    <span class="current-val">0 kWh</span>
                                    <span>→</span>
                                    <span class="optimal-val" id="optimalInstarinseEnergyBreakdown">560 kWh</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section style="background: var(--white); border-radius: 20px; padding: 40px; margin: 60px 0; text-align: center; border: 1px solid var(--neutral-200); box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
            <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-900); margin-bottom: 16px;">Export Detailed Report</h3>
            <p style="color: var(--neutral-600); margin-bottom: 30px; max-width: 100%; margin-left: auto; margin-right: auto; padding: 0 20px;">Download a comprehensive Excel report containing all site details, cleaning mixes, assumptions, calculations, and results for your records.</p>
            <button onclick="exportToExcel()" style="background: var(--success); color: white; border: none; padding: 16px 32px; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 1rem; transition: all 0.2s; box-shadow: 0 2px 8px rgba(48, 209, 88, 0.2);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(48, 209, 88, 0.3)'" onmouseout="this.style.transform=''; this.style.boxShadow='0 2px 8px rgba(48, 209, 88, 0.2)'">
                Export to Excel
            </button>
        </section>

        
    </div>

    <div class="modal-backdrop" id="modalBackdrop"></div>
    <div class="assumptions-modal" id="assumptionsModal">
        <div class="modal-header">
            <button class="close-btn" onclick="closeAssumptions(); return false;" title="Close" type="button" aria-label="Close assumptions panel">×</button>
            <h3 class="modal-title">Calculation Assumptions</h3>
            <p class="modal-subtitle">Modify values to match your specific situation</p>
        </div>
        
        <div class="modal-content">
            <div class="assumption-group">
                <h4 class="group-title">Paper Cup Assumptions</h4>
                <div class="assumption-item">
                    <label class="assumption-label">Cup Cost</label>
                    <div class="assumption-row">
                        <input type="number" id="paperCupCost" value="0.15" step="0.01" min="0" max="1" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">£/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('paperCupCost', 0.15)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.wrap.ngo/uk" class="source-link" target="_blank">WRAP UK</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Manufacturing Water</label>
                    <div class="assumption-row">
                        <input type="number" id="paperCupWater" value="0.25" step="0.1" min="0" max="1" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">L/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('paperCupWater', 0.25)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.epa.gov/sustainable-management-food/wasted-food-scale" class="source-link" target="_blank">EPA Sustainability Data</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Manufacturing Energy</label>
                    <div class="assumption-row">
                        <input type="number" id="paperCupEnergy" value="0.06" step="0.01" min="0" max="0.2" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">kWh/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('paperCupEnergy', 0.06)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.ellenmacarthurfoundation.org/topics/circular-economy-introduction/overview" class="source-link" target="_blank">Life Cycle Assessment Data</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Manufacturing CO₂</label>
                    <div class="assumption-row">
                        <input type="number" id="paperCupCo2" value="0.01" step="0.01" min="0" max="0.05" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">kg/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('paperCupCo2', 0.01)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.eea.europa.eu/en" class="source-link" target="_blank">European Environment Agency</a></div>
                </div>
            </div>
            
            <div class="assumption-group">
                <h4 class="group-title">Hand Washing Assumptions</h4>
                <div class="assumption-item">
                    <label class="assumption-label">Water per Wash</label>
                    <div class="assumption-row">
                        <input type="number" id="handwashWater" value="1.0" step="0.1" min="0" max="5" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">L/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('handwashWater', 1.0)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://waterwise.org.uk" class="source-link" target="_blank">Waterwise UK</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Energy per Wash</label>
                    <div class="assumption-row">
                        <input type="number" id="handwashEnergy" value="0.08" step="0.01" min="0" max="0.2" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">kWh/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('handwashEnergy', 0.08)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.gov.uk/government/statistics/energy-consumption-in-the-uk-2023" class="source-link" target="_blank">UK Government Energy Data</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Detergent Cost</label>
                    <div class="assumption-row">
                        <input type="number" id="handwashDetergent" value="0.01" step="0.01" min="0" max="0.1" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">£/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('handwashDetergent', 0.01)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source">Market research</div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">CO₂ Emissions</label>
                    <div class="assumption-row">
                        <input type="number" id="handwashCo2" value="0.02" step="0.01" min="0" max="0.1" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">kg/cup</span>
                        <button class="reset-btn" onclick="resetAssumption('handwashCo2', 0.02)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.eea.europa.eu/en" class="source-link" target="_blank">European Environment Agency</a></div>
                </div>
            </div>
            
            <div class="assumption-group">
                <h4 class="group-title">Dishwasher Assumptions</h4>
                <div class="assumption-item">
                    <label class="assumption-label">Capacity</label>
                    <div class="assumption-row">
                        <input type="number" id="dishwasherCapacity" value="40" step="1" min="10" max="100" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">cups/load</span>
                        <button class="reset-btn" onclick="resetAssumption('dishwasherCapacity', 40)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Water per Load</label>
                    <div class="assumption-row">
                        <input type="number" id="dishwasherWater" value="13.2" step="0.1" min="5" max="25" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">L/load</span>
                        <button class="reset-btn" onclick="resetAssumption('dishwasherWater', 13.2)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Energy per Load</label>
                    <div class="assumption-row">
                        <input type="number" id="dishwasherEnergy" value="0.9" step="0.1" min="0.5" max="3" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">kWh/load</span>
                        <button class="reset-btn" onclick="resetAssumption('dishwasherEnergy', 0.9)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.energystar.gov" class="source-link" target="_blank">Energy Star</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">CO₂ per Load</label>
                    <div class="assumption-row">
                        <input type="number" id="dishwasherCo2" value="0.16" step="0.01" min="0.1" max="1" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">kg/load</span>
                        <button class="reset-btn" onclick="resetAssumption('dishwasherCo2', 0.16)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.eea.europa.eu/en" class="source-link" target="_blank">European Environment Agency</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Detergent per Load</label>
                    <div class="assumption-row">
                        <input type="number" id="dishwasherDetergent" value="0.15" step="0.01" min="0.05" max="0.5" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">£/load</span>
                        <button class="reset-btn" onclick="resetAssumption('dishwasherDetergent', 0.15)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source">Industry research</div>
                </div>
            </div>
            
            <div class="assumption-group">
                <h4 class="group-title">Economic Assumptions</h4>
                <div class="assumption-item">
                    <label class="assumption-label">Electricity Rate</label>
                    <div class="assumption-row">
                        <input type="number" id="electricityRate" value="0.25" step="0.01" min="0.1" max="1" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">£/kWh</span>
                        <button class="reset-btn" onclick="resetAssumption('electricityRate', 0.25)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.ofgem.gov.uk/information-consumers/energy-advice-households/energy-price-cap-explained" class="source-link" target="_blank">Ofgem Price Cap</a></div>
                </div>
                <div class="assumption-item">
                    <label class="assumption-label">Labour Rate</label>
                    <div class="assumption-row">
                        <input type="number" id="labourRate" value="12.21" step="0.50" min="8" max="30" class="assumption-input" onchange="updateCalculations()">
                        <span class="assumption-unit">£/hour</span>
                        <button class="reset-btn" onclick="resetAssumption('labourRate', 12.21)">
                            <svg viewBox="0 0 24 24"><path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"/></svg>
                        </button>
                    </div>
                    <div class="assumption-source"><a href="https://www.gov.uk/national-minimum-wage-rates" class="source-link" target="_blank">UK Government</a></div>
                </div>
                
                <div style="padding: 20px; text-align: center; border-top: 1px solid var(--neutral-200); background: var(--neutral-50);">
                    <button onclick="closeAssumptions(); return false;" style="background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;">
                        Done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const DEFAULT_ASSUMPTIONS = {
            electricityRate: 0.25, labourRate: 12.21,
            paperCup: { cost: 0.15, water: 0.25, energy: 0.06, co2: 0.01 },
            handwash: { waterPerCup: 1.0, energyPerCup: 0.08, co2PerCup: 0.02, detergentPerCup: 0.01 },
            dishwasher: { capacity: 40, waterPerLoad: 13.2, energyPerLoad: 0.9, co2PerLoad: 0.16, labourTimePerLoad: 10, detergentPerLoad: 0.15 }
        };

        const GLOBAL_ASSUMPTIONS = JSON.parse(JSON.stringify(DEFAULT_ASSUMPTIONS));
        
        const INSTARINSE_CONSTANTS = {
            waterPerCup: 0.05, energyPerCup: 0.01, co2PerCup: 0.00, labourTimePerCup: 0.05 / 60
        };

        const state = {
            teamSize: 1500, officeDays: 4, cupsPerDay: 2,
            current: { paper: 30, handwash: 20, dishwasher: 50 },
            optimal: { paper: 0, instarinse: 70, handwash: 10, dishwasher: 20 }
        };

        const els = {
            teamSize: document.getElementById('teamSize'),
            officeDays: document.getElementById('officeDays'),
            cupsPerDay: document.getElementById('cupsPerDay'),
            dailyUsage: document.getElementById('dailyUsage'),
            
            currentPaper: document.getElementById('currentPaper'),
            currentHandwash: document.getElementById('currentHandwash'),
            currentDishwasher: document.getElementById('currentDishwasher'),
            currentPaperValue: document.getElementById('currentPaperValue'),
            currentHandwashValue: document.getElementById('currentHandwashValue'),
            currentDishwasherValue: document.getElementById('currentDishwasherValue'),
            currentPaperCups: document.getElementById('currentPaperCups'),
            currentHandwashCups: document.getElementById('currentHandwashCups'),
            currentDishwasherCups: document.getElementById('currentDishwasherCups'),
            currentValidation: document.getElementById('currentValidation'),
            
            optimalPaper: document.getElementById('optimalPaper'),
            optimalInstarinse: document.getElementById('optimalInstarinse'),
            optimalHandwash: document.getElementById('optimalHandwash'),
            optimalDishwasher: document.getElementById('optimalDishwasher'),
            optimalPaperValue: document.getElementById('optimalPaperValue'),
            optimalInstarinseValue: document.getElementById('optimalInstarinseValue'),
            optimalHandwashValue: document.getElementById('optimalHandwashValue'),
            optimalDishwasherValue: document.getElementById('optimalDishwasherValue'),
            optimalPaperCups: document.getElementById('optimalPaperCups'),
            optimalInstarinseCups: document.getElementById('optimalInstarinseCups'),
            optimalHandwashCups: document.getElementById('optimalHandwashCups'),
            optimalDishwasherCups: document.getElementById('optimalDishwasherCups'),
            optimalValidation: document.getElementById('optimalValidation'),
            
            resultsSection: document.getElementById('resultsSection'),
            breakdownSection: document.getElementById('breakdownSection'),
            costSavings: document.getElementById('costSavings'),
            waterSaved: document.getElementById('waterSaved'),
            co2Saved: document.getElementById('co2Saved'),
            timeSaved: document.getElementById('timeSaved'),
            
            currentCost: document.getElementById('currentCost'),
            newCost: document.getElementById('newCost'),
            savingsCost: document.getElementById('savingsCost'),
            savingsPercent: document.getElementById('savingsPercent'),
            currentWater: document.getElementById('currentWater'),
            newWater: document.getElementById('newWater'),
            savingsWater: document.getElementById('savingsWater'),
            waterPercent: document.getElementById('waterPercent'),
            currentCo2: document.getElementById('currentCo2'),
            newCo2: document.getElementById('newCo2'),
            savingsCo2: document.getElementById('savingsCo2'),
            co2Percent: document.getElementById('co2Percent'),
            currentEnergy: document.getElementById('currentEnergy'),
            newEnergy: document.getElementById('newEnergy'),
            savingsEnergy: document.getElementById('savingsEnergy'),
            energyPercent: document.getElementById('energyPercent')
        };

        function formatNumber(num, decimals = 0) {
            return num.toLocaleString('en-GB', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        }

        function formatCurrency(amount) { return '£' + formatNumber(amount, 0); }

        function updatePerCupCosts() {
            const paperCost = GLOBAL_ASSUMPTIONS.paperCup.cost;
            const handwashCost = GLOBAL_ASSUMPTIONS.handwash.detergentPerCup + (GLOBAL_ASSUMPTIONS.handwash.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate);
            const dishwasherCost = (GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad * GLOBAL_ASSUMPTIONS.electricityRate + GLOBAL_ASSUMPTIONS.dishwasher.labourTimePerLoad / 60 * GLOBAL_ASSUMPTIONS.labourRate + GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad) / GLOBAL_ASSUMPTIONS.dishwasher.capacity;
            const instarinseCost = INSTARINSE_CONSTANTS.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate + INSTARINSE_CONSTANTS.labourTimePerCup * GLOBAL_ASSUMPTIONS.labourRate;
            
            document.getElementById('paperCostDisplay').textContent = (paperCost * 100).toFixed(1);
            document.getElementById('handwashCostDisplay').textContent = (handwashCost * 100).toFixed(1);
            document.getElementById('dishwasherCostDisplay').textContent = (dishwasherCost * 100).toFixed(1);
            document.getElementById('instarinseCostDisplay').textContent = (instarinseCost * 100).toFixed(1);
            
            document.getElementById('paperCostOnly').textContent = (GLOBAL_ASSUMPTIONS.paperCup.cost * 100).toFixed(1);
            document.getElementById('paperWaterOnly').textContent = GLOBAL_ASSUMPTIONS.paperCup.water.toFixed(2);
            document.getElementById('paperCo2Only').textContent = (GLOBAL_ASSUMPTIONS.paperCup.co2 * 1000).toFixed(0);
            document.getElementById('paperEnergyOnly').textContent = GLOBAL_ASSUMPTIONS.paperCup.energy.toFixed(2);
            
            document.getElementById('handwashDetergentOnly').textContent = (GLOBAL_ASSUMPTIONS.handwash.detergentPerCup * 100).toFixed(1);
            document.getElementById('handwashWaterOnly').textContent = GLOBAL_ASSUMPTIONS.handwash.waterPerCup.toFixed(1);
            document.getElementById('handwashCo2Only').textContent = (GLOBAL_ASSUMPTIONS.handwash.co2PerCup * 1000).toFixed(0);
            document.getElementById('handwashEnergyOnly').textContent = GLOBAL_ASSUMPTIONS.handwash.energyPerCup.toFixed(2);
            
            const dishwasherLoadCost = GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad * GLOBAL_ASSUMPTIONS.electricityRate + GLOBAL_ASSUMPTIONS.dishwasher.labourTimePerLoad / 60 * GLOBAL_ASSUMPTIONS.labourRate + GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad;
            document.getElementById('dishwasherLoadCost').textContent = dishwasherLoadCost.toFixed(2);
            document.getElementById('dishwasherWaterOnly').textContent = (GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad / GLOBAL_ASSUMPTIONS.dishwasher.capacity).toFixed(2);
            document.getElementById('dishwasherCo2Only').textContent = (GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad / GLOBAL_ASSUMPTIONS.dishwasher.capacity * 1000).toFixed(0);
            document.getElementById('dishwasherEnergyOnly').textContent = (GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad / GLOBAL_ASSUMPTIONS.dishwasher.capacity).toFixed(2);
            
            const instarinseLabourCostPer100 = INSTARINSE_CONSTANTS.labourTimePerCup * 100 * GLOBAL_ASSUMPTIONS.labourRate;
            const instarinseLabourTimePer100 = INSTARINSE_CONSTANTS.labourTimePerCup * 100 * 60;
            document.getElementById('instarinseOpOnly').textContent = (instarinseCost * 100).toFixed(1);
            document.getElementById('instarinseWaterOnly').textContent = (INSTARINSE_CONSTANTS.waterPerCup * 1000).toFixed(0);
            document.getElementById('instarinseCo2Only').textContent = (INSTARINSE_CONSTANTS.co2PerCup * 1000).toFixed(0);
            document.getElementById('instarinseEnergyOnly').textContent = INSTARINSE_CONSTANTS.energyPerCup.toFixed(2);
            document.getElementById('instarinseLabourTime').textContent = instarinseLabourTimePer100.toFixed(0);
            
            document.getElementById('dishwasherCapacityNote').textContent = GLOBAL_ASSUMPTIONS.dishwasher.capacity;
        }

        function updateDailyUsage() {
            const daily = (state.teamSize * state.cupsPerDay * state.officeDays) / 5;
            els.dailyUsage.textContent = formatNumber(daily);
            
            updateSliderDisplay('current');
            updateSliderDisplay('optimal');
            calculateSavings();
        }

        function updateSliderDisplay(type) {
            const mix = state[type];
            const total = Object.values(mix).reduce((sum, val) => sum + val, 0);
            const dailyCups = (state.teamSize * state.cupsPerDay * state.officeDays) / 5;
            
            if (type === 'current') {
                els.currentPaperValue.textContent = mix.paper + '%';
                els.currentHandwashValue.textContent = mix.handwash + '%';
                els.currentDishwasherValue.textContent = mix.dishwasher + '%';
                
                els.currentPaperCups.textContent = formatNumber((mix.paper / 100) * dailyCups, 0) + ' cups/day';
                els.currentHandwashCups.textContent = formatNumber((mix.handwash / 100) * dailyCups, 0) + ' cups/day';
                els.currentDishwasherCups.textContent = formatNumber((mix.dishwasher / 100) * dailyCups, 0) + ' cups/day';
                
                els.currentValidation.textContent = total === 100 ? 'Perfect! Total: 100%' : `Total: ${total}% - adjust to 100%`;
                els.currentValidation.className = total === 100 ? 'validation valid' : 'validation invalid';
            } else {
                els.optimalPaperValue.textContent = mix.paper + '%';
                els.optimalInstarinseValue.textContent = mix.instarinse + '%';
                els.optimalHandwashValue.textContent = mix.handwash + '%';
                els.optimalDishwasherValue.textContent = mix.dishwasher + '%';
                
                els.optimalPaperCups.textContent = formatNumber((mix.paper / 100) * dailyCups, 0) + ' cups/day';
                els.optimalInstarinseCups.textContent = formatNumber((mix.instarinse / 100) * dailyCups, 0) + ' cups/day';
                els.optimalHandwashCups.textContent = formatNumber((mix.handwash / 100) * dailyCups, 0) + ' cups/day';
                els.optimalDishwasherCups.textContent = formatNumber((mix.dishwasher / 100) * dailyCups, 0) + ' cups/day';
                
                els.optimalValidation.textContent = total === 100 ? 'Perfect! Total: 100%' : `Total: ${total}% - adjust to 100%`;
                els.optimalValidation.className = total === 100 ? 'validation valid' : 'validation invalid';
            }
            calculateSavings();
        }

        function calculateSavings() {
            const currentTotal = Object.values(state.current).reduce((sum, val) => sum + val, 0);
            const optimalTotal = Object.values(state.optimal).reduce((sum, val) => sum + val, 0);
            
            if (currentTotal !== 100 || optimalTotal !== 100) {
                els.resultsSection.classList.add('hidden');
                return;
            }
            
            els.resultsSection.classList.remove('hidden');
            
            const annualCups = state.teamSize * state.cupsPerDay * state.officeDays * 52;
            
            const currentPaperCups = annualCups * (state.current.paper / 100);
            const currentHandwashCups = annualCups * (state.current.handwash / 100);
            const currentDishwasherCups = annualCups * (state.current.dishwasher / 100);
            
            const optimalPaperCups = annualCups * (state.optimal.paper / 100);
            const optimalInstarinseCups = annualCups * (state.optimal.instarinse / 100);
            const optimalHandwashCups = annualCups * (state.optimal.handwash / 100);
            const optimalDishwasherCups = annualCups * (state.optimal.dishwasher / 100);
            
            const paperCostPerCup = GLOBAL_ASSUMPTIONS.paperCup.cost;
            const handwashCostPerCup = GLOBAL_ASSUMPTIONS.handwash.detergentPerCup + (GLOBAL_ASSUMPTIONS.handwash.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate);
            const dishwasherCostPerCup = (GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad * GLOBAL_ASSUMPTIONS.electricityRate + GLOBAL_ASSUMPTIONS.dishwasher.labourTimePerLoad / 60 * GLOBAL_ASSUMPTIONS.labourRate + GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad) / GLOBAL_ASSUMPTIONS.dishwasher.capacity;
            const instarinseCostPerCup = INSTARINSE_CONSTANTS.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate + INSTARINSE_CONSTANTS.labourTimePerCup * GLOBAL_ASSUMPTIONS.labourRate;
            
            const currentCost = (currentPaperCups * paperCostPerCup) + (currentHandwashCups * handwashCostPerCup) + (currentDishwasherCups * dishwasherCostPerCup);
            const optimalCost = (optimalPaperCups * paperCostPerCup) + (optimalInstarinseCups * instarinseCostPerCup) + (optimalHandwashCups * handwashCostPerCup) + (optimalDishwasherCups * dishwasherCostPerCup);
            
            const currentWater = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad);
            const optimalWater = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.waterPerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad);
            
            const currentCO2 = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad);
            const optimalCO2 = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.co2PerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad);
            
            const currentEnergy = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad);
            const optimalEnergy = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.energyPerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad);
            
            const costSavings = Math.max(0, currentCost - optimalCost);
            const waterSavings = Math.max(0, currentWater - optimalWater);
            const co2Savings = Math.max(0, currentCO2 - optimalCO2);
            const energySavings = Math.max(0, currentEnergy - optimalEnergy);
            
            els.costSavings.textContent = formatCurrency(costSavings);
            els.waterSaved.textContent = formatNumber(waterSavings, 0) + 'L';
            els.co2Saved.textContent = formatNumber(co2Savings, 0) + 'kg';
            els.timeSaved.textContent = formatNumber(energySavings, 0) + ' kWh';
            
            els.currentCost.textContent = formatCurrency(currentCost);
            els.newCost.textContent = formatCurrency(optimalCost);
            els.savingsCost.textContent = formatCurrency(costSavings);
            els.savingsPercent.textContent = currentCost > 0 ? Math.round((costSavings / currentCost) * 100) + '%' : '0%';
            
            els.currentWater.textContent = formatNumber(currentWater, 0) + 'L';
            els.newWater.textContent = formatNumber(optimalWater, 0) + 'L';
            els.savingsWater.textContent = formatNumber(waterSavings, 0) + 'L';
            els.waterPercent.textContent = currentWater > 0 ? Math.round((waterSavings / currentWater) * 100) + '%' : '0%';
            
            els.currentCo2.textContent = formatNumber(currentCO2, 0) + 'kg';
            els.newCo2.textContent = formatNumber(optimalCO2, 0) + 'kg';
            els.savingsCo2.textContent = formatNumber(co2Savings, 0) + 'kg';
            els.co2Percent.textContent = currentCO2 > 0 ? Math.round((co2Savings / currentCO2) * 100) + '%' : '0%';
            
            els.currentEnergy.textContent = formatNumber(currentEnergy, 0) + ' kWh';
            els.newEnergy.textContent = formatNumber(optimalEnergy, 0) + ' kWh';
            els.savingsEnergy.textContent = formatNumber(energySavings, 0) + ' kWh';
            els.energyPercent.textContent = currentEnergy > 0 ? Math.round((energySavings / currentEnergy) * 100) + '%' : '0%';
            
            // Update detailed breakdown values
            updateBreakdownValues(currentPaperCups, currentHandwashCups, currentDishwasherCups, optimalPaperCups, optimalInstarinseCups, optimalHandwashCups, optimalDishwasherCups);
        }

        function toggleImpactBreakdown(type) {
            const breakdown = document.getElementById(type + 'BreakdownImpact');
            const indicator = document.getElementById(type + 'Indicator');
            
            if (breakdown.classList.contains('open')) {
                breakdown.classList.remove('open');
                indicator.classList.remove('rotated');
            } else {
                breakdown.classList.add('open');
                indicator.classList.add('rotated');
            }
        }

        function updateBreakdownValues(currentPaperCups, currentHandwashCups, currentDishwasherCups, optimalPaperCups, optimalInstarinseCups, optimalHandwashCups, optimalDishwasherCups) {
            const paperCostPerCup = GLOBAL_ASSUMPTIONS.paperCup.cost;
            const handwashCostPerCup = GLOBAL_ASSUMPTIONS.handwash.detergentPerCup + (GLOBAL_ASSUMPTIONS.handwash.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate);
            const dishwasherCostPerCup = (GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad * GLOBAL_ASSUMPTIONS.electricityRate + GLOBAL_ASSUMPTIONS.dishwasher.labourTimePerLoad / 60 * GLOBAL_ASSUMPTIONS.labourRate + GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad) / GLOBAL_ASSUMPTIONS.dishwasher.capacity;
            const instarinseCostPerCup = INSTARINSE_CONSTANTS.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate + INSTARINSE_CONSTANTS.labourTimePerCup * GLOBAL_ASSUMPTIONS.labourRate;
            
            if (document.getElementById('currentPaperCostBreakdown')) {
                document.getElementById('currentPaperCostBreakdown').textContent = formatCurrency(currentPaperCups * paperCostPerCup);
                document.getElementById('currentHandwashCostBreakdown').textContent = formatCurrency(currentHandwashCups * handwashCostPerCup);
                document.getElementById('currentDishwasherCostBreakdown').textContent = formatCurrency(currentDishwasherCups * dishwasherCostPerCup);
                document.getElementById('optimalPaperCostBreakdown').textContent = formatCurrency(optimalPaperCups * paperCostPerCup);
                document.getElementById('optimalHandwashCostBreakdown').textContent = formatCurrency(optimalHandwashCups * handwashCostPerCup);
                document.getElementById('optimalDishwasherCostBreakdown').textContent = formatCurrency(optimalDishwasherCups * dishwasherCostPerCup);
                document.getElementById('optimalInstarinseCostBreakdown').textContent = formatCurrency(optimalInstarinseCups * instarinseCostPerCup);
                
                document.getElementById('currentPaperWaterBreakdown').textContent = formatNumber(currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water, 0) + 'L';
                document.getElementById('currentHandwashWaterBreakdown').textContent = formatNumber(currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup, 0) + 'L';
                document.getElementById('currentDishwasherWaterBreakdown').textContent = formatNumber(currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad, 0) + 'L';
                document.getElementById('optimalPaperWaterBreakdown').textContent = formatNumber(optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water, 0) + 'L';
                document.getElementById('optimalHandwashWaterBreakdown').textContent = formatNumber(optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup, 0) + 'L';
                document.getElementById('optimalDishwasherWaterBreakdown').textContent = formatNumber(optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad, 0) + 'L';
                document.getElementById('optimalInstarinseWaterBreakdown').textContent = formatNumber(optimalInstarinseCups * INSTARINSE_CONSTANTS.waterPerCup, 0) + 'L';
                
                document.getElementById('currentPaperCo2Breakdown').textContent = formatNumber(currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2, 0) + 'kg';
                document.getElementById('currentHandwashCo2Breakdown').textContent = formatNumber(currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup, 0) + 'kg';
                document.getElementById('currentDishwasherCo2Breakdown').textContent = formatNumber(currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad, 0) + 'kg';
                document.getElementById('optimalPaperCo2Breakdown').textContent = formatNumber(optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2, 0) + 'kg';
                document.getElementById('optimalHandwashCo2Breakdown').textContent = formatNumber(optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup, 0) + 'kg';
                document.getElementById('optimalDishwasherCo2Breakdown').textContent = formatNumber(optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad, 0) + 'kg';
                document.getElementById('optimalInstarinseCo2Breakdown').textContent = formatNumber(optimalInstarinseCups * INSTARINSE_CONSTANTS.co2PerCup, 0) + 'kg';
                
                document.getElementById('currentPaperEnergyBreakdown').textContent = formatNumber(currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy, 0) + ' kWh';
                document.getElementById('currentHandwashEnergyBreakdown').textContent = formatNumber(currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup, 0) + ' kWh';
                document.getElementById('currentDishwasherEnergyBreakdown').textContent = formatNumber(currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad, 0) + ' kWh';
                document.getElementById('optimalPaperEnergyBreakdown').textContent = formatNumber(optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy, 0) + ' kWh';
                document.getElementById('optimalHandwashEnergyBreakdown').textContent = formatNumber(optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup, 0) + ' kWh';
                document.getElementById('optimalDishwasherEnergyBreakdown').textContent = formatNumber(optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad, 0) + ' kWh';
                document.getElementById('optimalInstarinseEnergyBreakdown').textContent = formatNumber(optimalInstarinseCups * INSTARINSE_CONSTANTS.energyPerCup, 0) + ' kWh';
            }
        }

        function updateCalculations() {
            GLOBAL_ASSUMPTIONS.paperCup.cost = parseFloat(document.getElementById('paperCupCost')?.value) || DEFAULT_ASSUMPTIONS.paperCup.cost;
            GLOBAL_ASSUMPTIONS.paperCup.water = parseFloat(document.getElementById('paperCupWater')?.value) || DEFAULT_ASSUMPTIONS.paperCup.water;
            GLOBAL_ASSUMPTIONS.paperCup.energy = parseFloat(document.getElementById('paperCupEnergy')?.value) || DEFAULT_ASSUMPTIONS.paperCup.energy;
            GLOBAL_ASSUMPTIONS.paperCup.co2 = parseFloat(document.getElementById('paperCupCo2')?.value) || DEFAULT_ASSUMPTIONS.paperCup.co2;
            GLOBAL_ASSUMPTIONS.handwash.waterPerCup = parseFloat(document.getElementById('handwashWater')?.value) || DEFAULT_ASSUMPTIONS.handwash.waterPerCup;
            GLOBAL_ASSUMPTIONS.handwash.energyPerCup = parseFloat(document.getElementById('handwashEnergy')?.value) || DEFAULT_ASSUMPTIONS.handwash.energyPerCup;
            GLOBAL_ASSUMPTIONS.handwash.detergentPerCup = parseFloat(document.getElementById('handwashDetergent')?.value) || DEFAULT_ASSUMPTIONS.handwash.detergentPerCup;
            GLOBAL_ASSUMPTIONS.handwash.co2PerCup = parseFloat(document.getElementById('handwashCo2')?.value) || DEFAULT_ASSUMPTIONS.handwash.co2PerCup;
            GLOBAL_ASSUMPTIONS.dishwasher.capacity = parseFloat(document.getElementById('dishwasherCapacity')?.value) || DEFAULT_ASSUMPTIONS.dishwasher.capacity;
            GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad = parseFloat(document.getElementById('dishwasherWater')?.value) || DEFAULT_ASSUMPTIONS.dishwasher.waterPerLoad;
            GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad = parseFloat(document.getElementById('dishwasherEnergy')?.value) || DEFAULT_ASSUMPTIONS.dishwasher.energyPerLoad;
            GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad = parseFloat(document.getElementById('dishwasherCo2')?.value) || DEFAULT_ASSUMPTIONS.dishwasher.co2PerLoad;
            GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad = parseFloat(document.getElementById('dishwasherDetergent')?.value) || DEFAULT_ASSUMPTIONS.dishwasher.detergentPerLoad;
            GLOBAL_ASSUMPTIONS.electricityRate = parseFloat(document.getElementById('electricityRate')?.value) || DEFAULT_ASSUMPTIONS.electricityRate;
            GLOBAL_ASSUMPTIONS.labourRate = parseFloat(document.getElementById('labourRate')?.value) || DEFAULT_ASSUMPTIONS.labourRate;
            
            document.querySelectorAll('.assumption-input').forEach(input => {
                const fieldId = input.id;
                const currentValue = parseFloat(input.value);
                let defaultValue;
                
                switch(fieldId) {
                    case 'paperCupCost': defaultValue = DEFAULT_ASSUMPTIONS.paperCup.cost; break;
                    case 'paperCupWater': defaultValue = DEFAULT_ASSUMPTIONS.paperCup.water; break;
                    case 'paperCupEnergy': defaultValue = DEFAULT_ASSUMPTIONS.paperCup.energy; break;
                    case 'paperCupCo2': defaultValue = DEFAULT_ASSUMPTIONS.paperCup.co2; break;
                    case 'handwashWater': defaultValue = DEFAULT_ASSUMPTIONS.handwash.waterPerCup; break;
                    case 'handwashEnergy': defaultValue = DEFAULT_ASSUMPTIONS.handwash.energyPerCup; break;
                    case 'handwashDetergent': defaultValue = DEFAULT_ASSUMPTIONS.handwash.detergentPerCup; break;
                    case 'handwashCo2': defaultValue = DEFAULT_ASSUMPTIONS.handwash.co2PerCup; break;
                    case 'dishwasherCapacity': defaultValue = DEFAULT_ASSUMPTIONS.dishwasher.capacity; break;
                    case 'dishwasherWater': defaultValue = DEFAULT_ASSUMPTIONS.dishwasher.waterPerLoad; break;
                    case 'dishwasherEnergy': defaultValue = DEFAULT_ASSUMPTIONS.dishwasher.energyPerLoad; break;
                    case 'dishwasherCo2': defaultValue = DEFAULT_ASSUMPTIONS.dishwasher.co2PerLoad; break;
                    case 'dishwasherDetergent': defaultValue = DEFAULT_ASSUMPTIONS.dishwasher.detergentPerLoad; break;
                    case 'electricityRate': defaultValue = DEFAULT_ASSUMPTIONS.electricityRate; break;
                    case 'labourRate': defaultValue = DEFAULT_ASSUMPTIONS.labourRate; break;
                }
                
                if (Math.abs(defaultValue - currentValue) > 0.01) {
                    input.classList.add('modified');
                } else {
                    input.classList.remove('modified');
                }
            });
            
            updatePerCupCosts();
            calculateSavings();
        }

        function resetAssumption(fieldId, defaultValue) {
            const input = document.getElementById(fieldId);
            input.value = defaultValue;
            input.classList.remove('modified');
            updateCalculations();
        }

        function openAssumptions() {
            const backdrop = document.getElementById('modalBackdrop');
            const modal = document.getElementById('assumptionsModal');
            
            backdrop.classList.add('open');
            modal.classList.add('open');
            document.body.style.overflow = 'hidden';
            
            // Ensure mobile viewport is properly set
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
        }

        function closeAssumptions() {
            const backdrop = document.getElementById('modalBackdrop');
            const modal = document.getElementById('assumptionsModal');
            
            // Simple, reliable close
            backdrop.classList.remove('open');
            modal.classList.remove('open');
            
            // Reset body styles for mobile
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            
            // Clear any inline styles that might interfere
            backdrop.style.cssText = '';
            modal.style.cssText = '';
        }

        // Toggle breakdown rows in table
        function toggleBreakdown(type) {
            const icon = document.getElementById(type + 'Icon');
            const breakdown = document.getElementById(type + 'Breakdown');
            
            if (breakdown.classList.contains('open')) {
                breakdown.classList.remove('open');
                icon.classList.remove('rotated');
            } else {
                breakdown.classList.add('open');
                icon.classList.add('rotated');
            }
        }


        // Event listeners
        els.teamSize.addEventListener('input', (e) => { state.teamSize = parseInt(e.target.value) || 1500; updateDailyUsage(); });
        els.officeDays.addEventListener('input', (e) => { state.officeDays = parseInt(e.target.value) || 4; updateDailyUsage(); });
        els.cupsPerDay.addEventListener('input', (e) => { state.cupsPerDay = parseFloat(e.target.value) || 2; updateDailyUsage(); });

        els.currentPaper.addEventListener('input', (e) => { state.current.paper = parseInt(e.target.value); updateSliderDisplay('current'); });
        els.currentHandwash.addEventListener('input', (e) => { state.current.handwash = parseInt(e.target.value); updateSliderDisplay('current'); });
        els.currentDishwasher.addEventListener('input', (e) => { state.current.dishwasher = parseInt(e.target.value); updateSliderDisplay('current'); });

        els.optimalPaper.addEventListener('input', (e) => { state.optimal.paper = parseInt(e.target.value); updateSliderDisplay('optimal'); });
        els.optimalInstarinse.addEventListener('input', (e) => { state.optimal.instarinse = parseInt(e.target.value); updateSliderDisplay('optimal'); });
        els.optimalHandwash.addEventListener('input', (e) => { state.optimal.handwash = parseInt(e.target.value); updateSliderDisplay('optimal'); });
        els.optimalDishwasher.addEventListener('input', (e) => { state.optimal.dishwasher = parseInt(e.target.value); updateSliderDisplay('optimal'); });

        window.openAssumptions = openAssumptions;
        window.closeAssumptions = closeAssumptions;
        window.updateCalculations = updateCalculations;
        window.resetAssumption = resetAssumption;
        window.toggleBreakdown = toggleBreakdown;
        window.toggleImpactBreakdown = toggleImpactBreakdown;
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAssumptions();
            }
        });

        document.getElementById('modalBackdrop').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAssumptions();
            }
        });
        
        document.getElementById('assumptionsModal').addEventListener('click', function(e) {
            e.stopPropagation();
        });
        
        document.getElementById('modalBackdrop').addEventListener('touchend', function(e) {
            if (e.target === this) {
                closeAssumptions();
            }
        });

        updateDailyUsage();
        updateSliderDisplay('current');
        updateSliderDisplay('optimal');
        updatePerCupCosts();

        function exportToExcel() {
            const annualCups = state.teamSize * state.cupsPerDay * state.officeDays * 52;
            
            const currentPaperCups = annualCups * (state.current.paper / 100);
            const currentHandwashCups = annualCups * (state.current.handwash / 100);
            const currentDishwasherCups = annualCups * (state.current.dishwasher / 100);
            
            const optimalPaperCups = annualCups * (state.optimal.paper / 100);
            const optimalInstarinseCups = annualCups * (state.optimal.instarinse / 100);
            const optimalHandwashCups = annualCups * (state.optimal.handwash / 100);
            const optimalDishwasherCups = annualCups * (state.optimal.dishwasher / 100);
            
            const paperCostPerCup = GLOBAL_ASSUMPTIONS.paperCup.cost;
            const handwashCostPerCup = GLOBAL_ASSUMPTIONS.handwash.detergentPerCup + (GLOBAL_ASSUMPTIONS.handwash.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate);
            const dishwasherCostPerCup = (GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad * GLOBAL_ASSUMPTIONS.electricityRate + GLOBAL_ASSUMPTIONS.dishwasher.labourTimePerLoad / 60 * GLOBAL_ASSUMPTIONS.labourRate + GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad) / GLOBAL_ASSUMPTIONS.dishwasher.capacity;
            const instarinseCostPerCup = INSTARINSE_CONSTANTS.energyPerCup * GLOBAL_ASSUMPTIONS.electricityRate + INSTARINSE_CONSTANTS.labourTimePerCup * GLOBAL_ASSUMPTIONS.labourRate;
            
            const currentCost = (currentPaperCups * paperCostPerCup) + (currentHandwashCups * handwashCostPerCup) + (currentDishwasherCups * dishwasherCostPerCup);
            const optimalCost = (optimalPaperCups * paperCostPerCup) + (optimalInstarinseCups * instarinseCostPerCup) + (optimalHandwashCups * handwashCostPerCup) + (optimalDishwasherCups * dishwasherCostPerCup);
            
            const currentWater = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad);
            const optimalWater = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.waterPerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad);
            
            const currentCO2 = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad);
            const optimalCO2 = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.co2PerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad);
            
            const currentEnergy = (currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy) + (currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup) + (currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad);
            const optimalEnergy = (optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy) + (optimalInstarinseCups * INSTARINSE_CONSTANTS.energyPerCup) + (optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup) + (optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad);

            function cleanNumber(num) {
                return parseFloat(num.toString().replace(/,/g, ''));
            }
            
            function formatForExcel(num, decimals = 0) {
                return parseFloat(num.toFixed(decimals));
            }

            const csvData = [
                ['ImpactOS Saving Estimator Report'],
                ['Generated', new Date().toLocaleDateString('en-GB'), new Date().toLocaleTimeString('en-GB')],
                [''],
                [''],
                ['SITE CONFIGURATION'],
                ['Parameter', 'Value'],
                ['Site Users', state.teamSize],
                ['Operating Days Per Week', state.officeDays],
                ['Cups Per Person Per Day', state.cupsPerDay],
                ['Total Annual Cups', formatForExcel(annualCups)],
                ['Daily Average Cups', formatForExcel(annualCups/365)],
                [''],
                [''],
                ['CURRENT MIX PERCENTAGES'],
                ['Method', 'Percentage'],
                ['Paper Cups', `${state.current.paper}%`],
                ['Hand Washing', `${state.current.handwash}%`],
                ['Dishwasher', `${state.current.dishwasher}%`],
                ['Total', `${state.current.paper + state.current.handwash + state.current.dishwasher}%`],
                [''],
                [''],
                ['OPTIMISED MIX PERCENTAGES'],
                ['Method', 'Percentage'],
                ['Paper Cups', `${state.optimal.paper}%`],
                ['Instarinse', `${state.optimal.instarinse}%`],
                ['Hand Washing', `${state.optimal.handwash}%`],
                ['Dishwasher', `${state.optimal.dishwasher}%`],
                ['Total', `${state.optimal.paper + state.optimal.instarinse + state.optimal.handwash + state.optimal.dishwasher}%`],
                [''],
                [''],
                ['ANNUAL CUPS BY METHOD'],
                ['Method', 'Current Cups', 'Optimised Cups', 'Change'],
                ['Paper Cups', formatForExcel(currentPaperCups), formatForExcel(optimalPaperCups), formatForExcel(currentPaperCups - optimalPaperCups)],
                ['Hand Washing', formatForExcel(currentHandwashCups), formatForExcel(optimalHandwashCups), formatForExcel(currentHandwashCups - optimalHandwashCups)],
                ['Dishwasher', formatForExcel(currentDishwasherCups), formatForExcel(optimalDishwasherCups), formatForExcel(currentDishwasherCups - optimalDishwasherCups)],
                ['Instarinse', 0, formatForExcel(optimalInstarinseCups), formatForExcel(optimalInstarinseCups)],
                [''],
                [''],
                ['ANNUAL COST BREAKDOWN'],
                ['Method', 'Current Cost', 'Optimised Cost', 'Savings', 'Cost Per Cup'],
                ['Paper Cups', `£${formatForExcel(currentPaperCups * paperCostPerCup)}`, `£${formatForExcel(optimalPaperCups * paperCostPerCup)}`, `£${formatForExcel((currentPaperCups - optimalPaperCups) * paperCostPerCup)}`, `£${formatForExcel(paperCostPerCup, 2)}`],
                ['Hand Washing', `£${formatForExcel(currentHandwashCups * handwashCostPerCup)}`, `£${formatForExcel(optimalHandwashCups * handwashCostPerCup)}`, `£${formatForExcel((currentHandwashCups - optimalHandwashCups) * handwashCostPerCup)}`, `£${formatForExcel(handwashCostPerCup, 2)}`],
                ['Dishwasher', `£${formatForExcel(currentDishwasherCups * dishwasherCostPerCup)}`, `£${formatForExcel(optimalDishwasherCups * dishwasherCostPerCup)}`, `£${formatForExcel((currentDishwasherCups - optimalDishwasherCups) * dishwasherCostPerCup)}`, `£${formatForExcel(dishwasherCostPerCup, 2)}`],
                ['Instarinse', '£0', `£${formatForExcel(optimalInstarinseCups * instarinseCostPerCup)}`, `£${formatForExcel(-optimalInstarinseCups * instarinseCostPerCup)}`, `£${formatForExcel(instarinseCostPerCup, 2)}`],
                ['TOTAL', `£${formatForExcel(currentCost)}`, `£${formatForExcel(optimalCost)}`, `£${formatForExcel(currentCost - optimalCost)}`, ''],
                [''],
                [''],
                ['ANNUAL WATER BREAKDOWN'],
                ['Method', 'Current Usage', 'Optimised Usage', 'Water Savings'],
                ['Paper Cups', `${formatForExcel(currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water)}L`, `${formatForExcel(optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.water)}L`, `${formatForExcel((currentPaperCups - optimalPaperCups) * GLOBAL_ASSUMPTIONS.paperCup.water)}L`],
                ['Hand Washing', `${formatForExcel(currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup)}L`, `${formatForExcel(optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.waterPerCup)}L`, `${formatForExcel((currentHandwashCups - optimalHandwashCups) * GLOBAL_ASSUMPTIONS.handwash.waterPerCup)}L`],
                ['Dishwasher', `${formatForExcel(currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad)}L`, `${formatForExcel(optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad)}L`, `${formatForExcel((currentDishwasherCups - optimalDishwasherCups) / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad)}L`],
                ['Instarinse', '0L', `${formatForExcel(optimalInstarinseCups * INSTARINSE_CONSTANTS.waterPerCup)}L`, `${formatForExcel(-optimalInstarinseCups * INSTARINSE_CONSTANTS.waterPerCup)}L`],
                ['TOTAL', `${formatForExcel(currentWater)}L`, `${formatForExcel(optimalWater)}L`, `${formatForExcel(currentWater - optimalWater)}L`],
                [''],
                [''],
                ['ANNUAL CO2 BREAKDOWN'],
                ['Method', 'Current Emissions', 'Optimised Emissions', 'CO2 Reduction'],
                ['Paper Cups', `${formatForExcel(currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2)}kg`, `${formatForExcel(optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.co2)}kg`, `${formatForExcel((currentPaperCups - optimalPaperCups) * GLOBAL_ASSUMPTIONS.paperCup.co2)}kg`],
                ['Hand Washing', `${formatForExcel(currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup)}kg`, `${formatForExcel(optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.co2PerCup)}kg`, `${formatForExcel((currentHandwashCups - optimalHandwashCups) * GLOBAL_ASSUMPTIONS.handwash.co2PerCup)}kg`],
                ['Dishwasher', `${formatForExcel(currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad)}kg`, `${formatForExcel(optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad)}kg`, `${formatForExcel((currentDishwasherCups - optimalDishwasherCups) / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad)}kg`],
                ['Instarinse', '0kg', `${formatForExcel(optimalInstarinseCups * INSTARINSE_CONSTANTS.co2PerCup)}kg`, `${formatForExcel(-optimalInstarinseCups * INSTARINSE_CONSTANTS.co2PerCup)}kg`],
                ['TOTAL', `${formatForExcel(currentCO2)}kg`, `${formatForExcel(optimalCO2)}kg`, `${formatForExcel(currentCO2 - optimalCO2)}kg`],
                [''],
                [''],
                ['ANNUAL ENERGY BREAKDOWN'],
                ['Method', 'Current Usage', 'Optimised Usage', 'Energy Savings'],
                ['Paper Cups', `${formatForExcel(currentPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy)} kWh`, `${formatForExcel(optimalPaperCups * GLOBAL_ASSUMPTIONS.paperCup.energy)} kWh`, `${formatForExcel((currentPaperCups - optimalPaperCups) * GLOBAL_ASSUMPTIONS.paperCup.energy)} kWh`],
                ['Hand Washing', `${formatForExcel(currentHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup)} kWh`, `${formatForExcel(optimalHandwashCups * GLOBAL_ASSUMPTIONS.handwash.energyPerCup)} kWh`, `${formatForExcel((currentHandwashCups - optimalHandwashCups) * GLOBAL_ASSUMPTIONS.handwash.energyPerCup)} kWh`],
                ['Dishwasher', `${formatForExcel(currentDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad)} kWh`, `${formatForExcel(optimalDishwasherCups / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad)} kWh`, `${formatForExcel((currentDishwasherCups - optimalDishwasherCups) / GLOBAL_ASSUMPTIONS.dishwasher.capacity * GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad)} kWh`],
                ['Instarinse', '0 kWh', `${formatForExcel(optimalInstarinseCups * INSTARINSE_CONSTANTS.energyPerCup)} kWh`, `${formatForExcel(-optimalInstarinseCups * INSTARINSE_CONSTANTS.energyPerCup)} kWh`],
                ['TOTAL', `${formatForExcel(currentEnergy)} kWh`, `${formatForExcel(optimalEnergy)} kWh`, `${formatForExcel(currentEnergy - optimalEnergy)} kWh`],
                [''],
                [''],
                ['SUMMARY TOTALS'],
                ['Metric', 'Current Value', 'Optimised Value', 'Total Savings', 'Reduction %'],
                ['Annual Cost', `£${formatForExcel(currentCost)}`, `£${formatForExcel(optimalCost)}`, `£${formatForExcel(currentCost - optimalCost)}`, `${currentCost > 0 ? Math.round(((currentCost - optimalCost) / currentCost) * 100) : 0}%`],
                ['Water Usage', `${formatForExcel(currentWater)}L`, `${formatForExcel(optimalWater)}L`, `${formatForExcel(currentWater - optimalWater)}L`, `${currentWater > 0 ? Math.round(((currentWater - optimalWater) / currentWater) * 100) : 0}%`],
                ['CO2 Emissions', `${formatForExcel(currentCO2)}kg`, `${formatForExcel(optimalCO2)}kg`, `${formatForExcel(currentCO2 - optimalCO2)}kg`, `${currentCO2 > 0 ? Math.round(((currentCO2 - optimalCO2) / currentCO2) * 100) : 0}%`],
                ['Energy Usage', `${formatForExcel(currentEnergy)} kWh`, `${formatForExcel(optimalEnergy)} kWh`, `${formatForExcel(currentEnergy - optimalEnergy)} kWh`, `${currentEnergy > 0 ? Math.round(((currentEnergy - optimalEnergy) / currentEnergy) * 100) : 0}%`],
                [''],
                [''],
                ['ASSUMPTIONS USED'],
                ['Paper Cup Cost per Cup', GLOBAL_ASSUMPTIONS.paperCup.cost],
                ['Paper Cup Water per Cup L', GLOBAL_ASSUMPTIONS.paperCup.water],
                ['Paper Cup Energy per Cup kWh', GLOBAL_ASSUMPTIONS.paperCup.energy],
                ['Paper Cup CO2 per Cup KG', GLOBAL_ASSUMPTIONS.paperCup.co2],
                ['Hand Wash Water per Cup L', GLOBAL_ASSUMPTIONS.handwash.waterPerCup],
                ['Hand Wash Energy per Cup kWh', GLOBAL_ASSUMPTIONS.handwash.energyPerCup],
                ['Hand Wash CO2 per Cup KG', GLOBAL_ASSUMPTIONS.handwash.co2PerCup],
                ['Hand Wash Detergent per Cup GBP', GLOBAL_ASSUMPTIONS.handwash.detergentPerCup],
                ['Dishwasher Capacity Cups', GLOBAL_ASSUMPTIONS.dishwasher.capacity],
                ['Dishwasher Water per Load L', GLOBAL_ASSUMPTIONS.dishwasher.waterPerLoad],
                ['Dishwasher Energy per Load kWh', GLOBAL_ASSUMPTIONS.dishwasher.energyPerLoad],
                ['Dishwasher CO2 per Load KG', GLOBAL_ASSUMPTIONS.dishwasher.co2PerLoad],
                ['Dishwasher Labour per Load Min', GLOBAL_ASSUMPTIONS.dishwasher.labourTimePerLoad],
                ['Dishwasher Detergent per Load GBP', GLOBAL_ASSUMPTIONS.dishwasher.detergentPerLoad],
                ['Instarinse Water per Cup L', INSTARINSE_CONSTANTS.waterPerCup],
                ['Instarinse Energy per Cup kWh', INSTARINSE_CONSTANTS.energyPerCup],
                ['Instarinse CO2 per Cup KG', INSTARINSE_CONSTANTS.co2PerCup],
                ['Instarinse Labour per Cup Hours', INSTARINSE_CONSTANTS.labourTimePerCup],
                ['Electricity Rate GBP per kWh', GLOBAL_ASSUMPTIONS.electricityRate],
                ['Labour Rate GBP per Hour', GLOBAL_ASSUMPTIONS.labourRate]
            ];

            const csvContent = csvData.map(row => 
                row.map(cell => {
                    const str = String(cell);
                    if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                        return `"${str.replace(/"/g, '""')}"`;
                    }
                    return str;
                }).join(',')
            ).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `impactos-saving-estimator-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        window.exportToExcel = exportToExcel;
    </script>
</body>
</html>